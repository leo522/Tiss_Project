/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x2f3fe1 from'./../messagescompressor.js';import _0x2e6f6d from'./messages/addcommentmessage.js';import _0x3e1582 from'./responses/addcommentresponse.js';import _0x3ef17a from'./messages/connectmessage.js';import _0x4229bc from'./responses/connectresponse.js';import _0x2a9bc0 from'./messages/removecommentmessage.js';import _0x3f0764 from'./messages/removecommentthreadmessage.js';import _0x20dffd from'./messages/updatecommentmessage.js';import _0x45e4ee from'./messages/getcommentthreadmessage.js';import _0xbee89a from'./responses/getcommentthreadresponse.js';import _0x14ba53 from'./messages/getdocumentthreadsmessage.js';import _0x3c3bad from'./responses/getdocumentthreadsresponse.js';import _0x3e5e57,{WEB_SOCKET_GATEWAY_STATES}from'./../websocketgateway/websocketgateway.js';import _0x4a1622 from'./../ckeditorcloudserviceserror.js';import _0x59405e from'../sessions/sessions.js';import _0xfb7060 from'../errors/ServiceNotConnectedError.js';import _0x202c4a from'../ckeditorcloudservicesservererror.js';import _0x11ce29 from'./responses/comment-threads/addcommentthreadresponse.js';import _0x419d0f from'./messages/comment-threads/addcommentthreadmessage.js';import _0x1e08fb from'./messages/comment-threads/resolvecommentthreadmessage.js';import _0x2e1f1a from'./messages/comment-threads/reopencommentthreadmessage.js';import _0x4b7bf2 from'./messages/comment-threads/updatecommentthreadmessage.js';import _0x5298a9 from'./responses/comment-threads/resolvecommentthreadresponse.js';export const _SERVICE=0x9;class CommentsService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0x58b678){super(),this['_documentId']=_0x58b678,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x3aa6c7){if(this['_isConnected'])return;if(_0x3aa6c7['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x4a1622('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x3aa6c7);const _0x31a25e=new _0x3ef17a(this['_documentId']);this['_wsGateway']=_0x3aa6c7,this['stopListening'](_0x3aa6c7,'change:state');const _0x1f629e=await _0x3aa6c7['_sendRequest'](0x9,_0x3ef17a['TYPE'],_0x2f3fe1['encode'](_0x31a25e)),{channel:_0x598d98,threads:_0x49a70b}=_0x2f3fe1['decode'](_0x1f629e,_0x4229bc);return this['listenTo'](_0x3aa6c7,'change:state',(_0x2c075c,_0x32b31e,_0x222fb4)=>this['_onWsGatewayStateChange'](_0x222fb4),{'priority':_0x3e5e57['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x3aa6c7,_0x598d98),this['_isConnected']=!0x0,this['fire']('connected'),_0x49a70b;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x5b4c94,_0x40656e,_0x5a44c4,_0x4be241){const _0x792d1e=new _0x2e6f6d(this['_documentId'],_0x5b4c94,_0x5a44c4,_0x40656e,void 0x0,void 0x0,_0x4be241),_0x5a017d=await this['_sendRequest'](_0x2e6f6d['TYPE'],_0x792d1e);return _0x2f3fe1['decode'](_0x5a017d,_0x3e1582);}async['updateComment'](_0x348e3b,_0x23f399,_0x1e161b,_0x310101){const _0xdc715d=void 0x0!==_0x310101,_0x1078f9=new _0x20dffd(this['_documentId'],_0x348e3b,_0x23f399,_0x1e161b,_0x310101,_0xdc715d);await this['_sendRequest'](_0x20dffd['TYPE'],_0x1078f9);}async['removeComment'](_0x635fd3,_0x2cef3c){const _0xdf1637=new _0x2a9bc0(this['_documentId'],_0x635fd3,_0x2cef3c);await this['_sendRequest'](_0x2a9bc0['TYPE'],_0xdf1637);}async['removeCommentThread'](_0x39b018){const _0x314638=new _0x3f0764(this['_documentId'],_0x39b018);await this['_sendRequest'](_0x3f0764['TYPE'],_0x314638);}async['addCommentThread'](_0x5f1d95){var _0x2567e7;const _0x1a0d61=new _0x419d0f(this['_documentId'],_0x5f1d95['commentThreadId'],null===(_0x2567e7=_0x5f1d95['comments'])||void 0x0===_0x2567e7?void 0x0:_0x2567e7['map'](_0x32fe63=>({..._0x32fe63,'documentId':this['_documentId'],'commentThreadId':_0x5f1d95['commentThreadId']})),_0x5f1d95['context'],_0x5f1d95['resolvedBy'],_0x5f1d95['createdAt'],_0x5f1d95['resolvedAt'],_0x5f1d95['deletedAt'],_0x5f1d95['attributes']),_0x2236d2=await this['_sendRequest'](_0x419d0f['TYPE'],_0x1a0d61);return _0x2f3fe1['decode'](_0x2236d2,_0x11ce29);}async['resolveCommentThread'](_0x2015ac){const _0xe660a9=new _0x1e08fb(_0x2015ac,this['_documentId']),_0x5f22fb=await this['_sendRequest'](_0x1e08fb['TYPE'],_0xe660a9);return _0x2f3fe1['decode'](_0x5f22fb,_0x5298a9);}async['reopenCommentThread'](_0x464586){const _0x1ddaca=new _0x2e1f1a(_0x464586,this['_documentId']);await this['_sendRequest'](_0x2e1f1a['TYPE'],_0x1ddaca);}async['updateCommentThread'](_0x24dc4d){const _0x4dd0e9=new _0x4b7bf2(_0x24dc4d['commentThreadId'],this['_documentId'],_0x24dc4d['context'],_0x24dc4d['attributes'],_0x24dc4d['unlinkedAt']);await this['_sendRequest'](_0x4b7bf2['TYPE'],_0x4dd0e9);}async['getCommentThread'](_0x3f9b53,_0x9a2cae=0x1){const _0x2f4fcf=new _0x45e4ee(_0x3f9b53,this['_documentId']);try{const _0x560a6b=await this['_sendRequest'](_0x45e4ee['TYPE'],_0x2f4fcf),_0x1ccc38=_0x2f3fe1['decode'](_0x560a6b,_0xbee89a);return{'commentThreadId':_0x1ccc38['commentThreadId'],'comments':_0x1ccc38['comments'],'attributes':_0x1ccc38['attributes'],'context':_0x1ccc38['context'],'resolvedAt':_0x1ccc38['resolvedAt'],'resolvedBy':_0x1ccc38['resolvedBy'],'deletedAt':_0x1ccc38['deletedAt'],'unlinkedAt':_0x1ccc38['unlinkedAt']};}catch(_0x2170e0){if('CKEditorCloudServicesServerError'===_0x2170e0['name']&&'404'===_0x2170e0['code']&&_0x9a2cae<0x5)return await(_0x1ffa64=0x64*_0x9a2cae,new Promise(_0x19554d=>{setTimeout(_0x19554d,_0x1ffa64);})),this['getCommentThread'](_0x3f9b53,_0x9a2cae+0x1);if('CKEditorCloudServicesServerError'===_0x2170e0['name'])throw _0x2170e0;throw _0x202c4a['fromPublicError'](_0x2170e0);}var _0x1ffa64;}async['getDocumentThreads'](){const _0x1278ce=new _0x14ba53(this['_documentId']),_0x1bed46=await this['_sendRequest'](_0x14ba53['TYPE'],_0x1278ce),{threads:_0x12db4a}=_0x2f3fe1['decode'](_0x1bed46,_0x3c3bad);return{'threads':_0x12db4a};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new _0xfb7060('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await _0x59405e['getConnectedSessions'](this['_wsGateway'],this['_documentId'],0x9)),this['_connectedSessions'];}['_connectToChannel'](_0x22f083,_0x2f2029){this['_channel']=_0x22f083['_getChannel'](CommentsService['_SERVICE'],_0x2f2029),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x2e6f6d['TYPE']),(_0x178178,_0x496a13)=>{const _0x7081e6=_0x2f3fe1['decode'](_0x496a13,_0x2e6f6d);this['fire']('commentAdded',_0x7081e6);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x2a9bc0['TYPE']),(_0xc33ab4,_0x13f0a1)=>{const _0x2379ef=_0x2f3fe1['decode'](_0x13f0a1,_0x2a9bc0);this['fire']('commentRemoved',_0x2379ef);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x20dffd['TYPE']),(_0x3f0036,_0x2594b8)=>{const _0x118239=_0x2f3fe1['decode'](_0x2594b8,_0x20dffd);this['fire']('commentUpdated',_0x118239);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x3f0764['TYPE']),(_0x119145,_0x306749)=>{const _0x4b1bd1=_0x2f3fe1['decode'](_0x306749,_0x3f0764);this['fire']('commentThreadRemoved',_0x4b1bd1);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x419d0f['TYPE']),(_0x13c5a4,_0x4c4eed)=>{const _0x287296=_0x2f3fe1['decode'](_0x4c4eed,_0x419d0f);this['fire']('commentThreadAdded',_0x287296);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x4b7bf2['TYPE']),(_0x11204e,_0x438835)=>{const _0x55479a=_0x2f3fe1['decode'](_0x438835,_0x4b7bf2);this['fire']('commentThreadUpdated',_0x55479a);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x1e08fb['TYPE']),(_0x31fcae,_0xa71fa4)=>{const _0x1814e0=_0x2f3fe1['decode'](_0xa71fa4,_0x1e08fb);this['fire']('commentThreadResolved',_0x1814e0);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x2e1f1a['TYPE']),(_0x5c9f0e,_0x516017)=>{const _0x3747e4=_0x2f3fe1['decode'](_0x516017,_0x2e1f1a);this['fire']('commentThreadReopened',_0x3747e4);}));}['_onWsGatewayStateChange'](_0x3d28d6){_0x3d28d6===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x565541,_0x5e68cf){if(!this['_wsGateway']||!this['_isConnected'])throw new _0xfb7060('Comments',this);return this['_wsGateway']['_sendRequest'](0x9,_0x565541,_0x2f3fe1['encode'](_0x5e68cf));}}CommentsService['_SERVICE']=0x9;export default CommentsService;