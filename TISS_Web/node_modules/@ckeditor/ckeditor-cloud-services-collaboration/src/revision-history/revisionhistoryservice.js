/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x247242 from'./../messagescompressor.js';import _0x318147 from'./messages/revisionhistorygetrevisionmessage.js';import _0x1ae337 from'./responses/revisionhistorygetrevisionresponse.js';import _0x320788 from'./messages/revisionhistoryupdaterevisionsmessage.js';import _0x389c11 from'./responses/revisionhistoryupdaterevisionsresponse.js';import _0x42e3e1 from'./messages/revisionhistoryconnectmessage.js';import _0x1fac2c from'./responses/revisionhistoryconnectresponse.js';import _0x3352f3 from'./messages/revisionhistoryreconnectmessage.js';import _0x2a2099 from'../ckeditorcloudserviceserror.js';import _0x2c0c0b,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0x1697ff from'../errors/ServiceNotConnectedError.js';export const _SERVICE=0xc;class RevisionHistoryService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0x4e5291){super(),this['_documentId']=_0x4e5291,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x5ea97e){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x5ea97e,new _0x42e3e1(this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x40ca8e,_0x40a4ba){if(this['isConnected'])throw new _0x2a2099('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x40ca8e);return this['_connect'](_0x40ca8e,new _0x3352f3(this['_documentId'],_0x40a4ba));}async['updateRevisions'](_0x5d744e,_0x33f703){const _0x2bafcd=_0x320788['create']({'documentId':this['_documentId'],'requestId':_0x33f703,'revisions':_0x5d744e}),_0x388f5f=await this['_sendRequest'](_0x320788['TYPE'],_0x2bafcd),{requestId:_0x2b568c}=_0x247242['decode'](_0x388f5f,_0x389c11);return _0x2b568c;}async['getRevision'](_0xd25768){const _0x213df9=new _0x318147(this['_documentId'],_0xd25768),_0x3e874c=await this['_sendRequest'](_0x318147['TYPE'],_0x213df9);return _0x247242['decode'](_0x3e874c,_0x1ae337)['toObject']();}async['_connect'](_0x362c26,_0x4bbd98){if(_0x362c26['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x2a2099('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x362c26);this['_wsGateway']=_0x362c26,this['stopListening'](_0x362c26,'change:state');const _0x4a293d=await _0x362c26['_sendRequest'](0xc,_0x4bbd98['constructor']['TYPE'],_0x247242['encode'](_0x4bbd98)),{channel:_0x415362,requestId:_0x53d2f4,revisions:_0x1809b6}=_0x247242['decode'](_0x4a293d,_0x1fac2c)['toObject']();return this['listenTo'](_0x362c26,'change:state',(_0x48018e,_0x5001ae,_0x11f448)=>this['_onWsGatewayStateChange'](_0x11f448),{'priority':_0x2c0c0b['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x362c26,_0x415362),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':_0x1809b6,'requestId':_0x53d2f4};}['_connectToChannel'](_0x2fd881,_0xa2179b){this['_channel']=_0x2fd881['_getChannel'](RevisionHistoryService['_SERVICE'],_0xa2179b),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x320788['TYPE']),(_0x419333,_0x254dfb)=>{const {documentId:_0x194899,requestId:_0xb55094,revisions:_0x3fd4ea}=_0x247242['decode'](_0x254dfb,_0x320788)['toObject']();this['fire']('revisionsUpdated',{'documentId':_0x194899,'requestId':_0xb55094,'revisionsData':_0x3fd4ea});});}['_onWsGatewayStateChange'](_0xb28e36){_0xb28e36===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x4b5567,_0x2032f5){if(!this['_wsGateway']||!this['_isConnected'])throw new _0x1697ff('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](0xc,_0x4b5567,_0x247242['encode'](_0x2032f5));}}RevisionHistoryService['_SERVICE']=0xc;export default RevisionHistoryService;