/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{EmitterMixin}from'ckeditor5/src/utils.js';import _0x50e27f from'./../messagescompressor.js';import _0x812379 from'./messages/addsuggestionmessage.js';import _0x571fc4 from'./responses/addsuggestionresponse.js';import _0x3e3137 from'./messages/getsuggestionmessage.js';import _0x1fe61e from'./responses/getsuggestionresponse.js';import _0x5627d3 from'./messages/getallsuggestionsmessage.js';import _0xae5281 from'./responses/getallsuggestionsresponse.js';import _0x21eef9 from'./messages/updatesuggestionmessage.js';import _0x14808e from'./messages/connectmessage.js';import _0x4f9a95 from'./responses/connectresponse.js';import _0x10b4f5 from'../ckeditorcloudserviceserror.js';import _0x22b009,{WEB_SOCKET_GATEWAY_STATES}from'../websocketgateway/websocketgateway.js';import _0xe4b4c2 from'../errors/ServiceNotConnectedError.js';import _0x1a20ff from'../ckeditorcloudservicesservererror.js';import _0x3a49b6 from'./messages/batchUpdateSuggestionsStateMessage.js';export const _SERVICE=0xa;class TrackChangesService extends/* #__PURE__ -- @preserve */
EmitterMixin(){constructor(_0x53d7fe){super(),this['_documentId']=_0x53d7fe,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x1bb61a){if(this['_isConnected'])return;if(_0x1bb61a['state']!==WEB_SOCKET_GATEWAY_STATES['CONNECTED'])throw new _0x10b4f5('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x1bb61a);const _0x2613f3=new _0x14808e(this['_documentId']);this['_wsGateway']=_0x1bb61a,this['stopListening'](_0x1bb61a,'change:state');const _0x3ed39b=await _0x1bb61a['_sendRequest'](0xa,_0x14808e['TYPE'],_0x50e27f['encode'](_0x2613f3)),_0x3c0d9c=_0x50e27f['decode'](_0x3ed39b,_0x4f9a95);return this['listenTo'](_0x1bb61a,'change:state',(_0xdb66c0,_0x59c934,_0x39435e)=>this['_onWsGatewayStateChange'](_0x39435e),{'priority':_0x22b009['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x1bb61a,_0x3c0d9c['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x3c0d9c['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x432b57,_0x4d5e30,_0xcfa094,_0x200594=null,_0x3977a9){const _0x5e9967=new _0x812379(_0x432b57,this['_documentId'],_0x4d5e30,_0xcfa094,_0x200594,_0x3977a9),_0x23991a=await this['_sendRequest'](_0x812379['TYPE'],_0x5e9967);return _0x50e27f['decode'](_0x23991a,_0x571fc4);}async['get'](_0x4894f4,_0xcd694c=0x1){const _0x5cee68=new _0x3e3137(_0x4894f4,this['_documentId']);try{const _0x376cd7=await this['_sendRequest'](_0x3e3137['TYPE'],_0x5cee68);return _0x50e27f['decode'](_0x376cd7,_0x1fe61e);}catch(_0x1f1edf){if('CKEditorCloudServicesServerError'===_0x1f1edf['name']&&'404'===_0x1f1edf['code']&&_0xcd694c<0x5)return await(_0x337c58=0x64*_0xcd694c,new Promise(_0x2e92a8=>{setTimeout(_0x2e92a8,_0x337c58);})),this['get'](_0x4894f4,_0xcd694c+0x1);if('CKEditorCloudServicesServerError'===_0x1f1edf['name'])throw _0x1f1edf;throw _0x1a20ff['fromPublicError'](_0x1f1edf);}var _0x337c58;}async['getAll'](){const _0x4dfbb7=new _0x5627d3(this['_documentId']),_0x19ec1f=await this['_sendRequest'](_0x5627d3['TYPE'],_0x4dfbb7),{suggestions:_0x4bd016}=_0x50e27f['decode'](_0x19ec1f,_0xae5281);return _0x4bd016;}async['update'](_0x4d39b2,_0x3b0213={}){const {hasComments:_0x555167,state:_0x141aa6,attributes:_0x4012aa}=_0x3b0213,_0x3739ef=void 0x0!==_0x555167,_0x5c0d49=new _0x21eef9(_0x4d39b2,this['_documentId'],_0x555167,_0x3739ef,_0x141aa6,_0x4012aa);await this['_sendRequest'](_0x21eef9['TYPE'],_0x5c0d49);}async['batchUpdateState'](_0x55de5e){const _0x35a6a8=new _0x3a49b6(_0x55de5e['ids'],this['_documentId'],_0x55de5e['state']);await this['_sendRequest'](_0x3a49b6['TYPE'],_0x35a6a8);}['_connectToChannel'](_0xbe1baf,_0x390658){this['_channel']=_0xbe1baf['_getChannel'](TrackChangesService['_SERVICE'],_0x390658),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](_0x21eef9['TYPE']),(_0x53cf30,_0xec1cfe)=>{const _0x47ad69=_0x50e27f['decode'](_0xec1cfe,_0x21eef9);this['fire']('suggestionUpdated',_0x47ad69);});}['_onWsGatewayStateChange'](_0x12636a){_0x12636a===WEB_SOCKET_GATEWAY_STATES['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x459ac1,_0x584b5f){if(!this['_wsGateway']||!this['_isConnected'])throw new _0xe4b4c2('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](0xa,_0x459ac1,_0x50e27f['encode'](_0x584b5f));}}TrackChangesService['_SERVICE']=0xa;export default TrackChangesService;