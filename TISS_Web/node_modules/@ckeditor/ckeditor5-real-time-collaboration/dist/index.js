/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{ContextPlugin as _0x51b4aa,Plugin as _0x3f2414,PendingActions as _0x37aea0,Context as _0x4feb74}from'@ckeditor/ckeditor5-core/dist/index.js';import{DomEmitterMixin as _0x46c19a,CKEditorError as _0x2bc765,Collection as _0x5109e1,global as _0x32b6fd,version as nt,uid as _0x4976cf}from'@ckeditor/ckeditor5-utils/dist/index.js';import{Notification as _0x29a42b,View as _0x3f2a09,BalloonPanelView as _0x389e13,clickOutsideHandler as _0x3bdd20,BodyCollection as _0x587dfd}from'@ckeditor/ckeditor5-ui/dist/index.js';import{LiveRange as ht,History as _0x437638,NoOperation as _0x1d7bb6,InsertOperation as _0x55de0c,MarkerOperation as _0x493d42,RootAttributeOperation as _0x32919d,transformSets as _0xaa48ff,OperationFactory as _0x5002ae}from'@ckeditor/ckeditor5-engine/dist/index.js';import{WebSocketGateway as at,WEB_SOCKET_GATEWAY_STATES as _0x47b369,CollaborativeEditingService as _0x5168a7,User as dt,CommentsService as _0x34e845,TrackChangesService as et,RevisionHistoryService as it,EditorService as tt}from'@ckeditor/ckeditor-cloud-services-collaboration/dist/index.js';import{Users as _0x2441e3,UserView as ct}from'ckeditor5-collaboration/dist/index.js';import{Compressor as _0xa38b1f}from'@ckeditor/ckeditor5-operations-compressor/dist/index.js';import{isElement as _0x189686}from'lodash-es';class c extends _0x51b4aa{static ['WebSocketGateway']=/* #__PURE__ -- @preserve */
((()=>at)());static ['initialReconnectionInterval']=0x3e8;['connection'];['_reconnectionStack'];['_shouldPluginsReconnect'];['_domEmitter'];static get['requires'](){return['CloudServices',_0x29a42b];}static get['pluginName'](){return'WebSocketGateway';}constructor(_0x111922){super(_0x111922),this['set']('state',_0x47b369['CONNECTED']),this['set']('_isBrowserOffline',!0x1),this['_reconnectionStack']=new Set(),this['_shouldPluginsReconnect']=!0x1,this['_domEmitter']=Object['create'](_0x46c19a);}['init'](){const _0xe92d0a=this['context'],_0x32ab09=_0xe92d0a['plugins']['get']('CloudServices'),_0xb74de5=_0xe92d0a['plugins']['get'](_0x29a42b);if(!_0x32ab09['token'])throw new _0x2bc765('websocketgateway-missing-token',this);if(!_0x32ab09['webSocketUrl'])throw new _0x2bc765('websocketgateway-missing-websocket-url',this);return this['_domEmitter']['listenTo'](window,'offline',()=>this['_isBrowserOffline']=!0x0),this['_domEmitter']['listenTo'](window,'online',()=>this['_isBrowserOffline']=!0x1),this['context']['config']['define']('cloudServices.connectionTimeout',0xa),this['context']['config']['define']('cloudServices.requestTimeout',0x14),c['WebSocketGateway']['connect'](_0x32ab09['token'],_0x32ab09['webSocketUrl'],{'timeout':0x3e8*this['context']['config']['get']('cloudServices.connectionTimeout'),'requestTimeout':0x3e8*this['context']['config']['get']('cloudServices.requestTimeout')})['then'](_0x171c08=>{if(this['connection']=_0x171c08,this['bind']('state')['to'](_0x171c08,'state',this,'_isBrowserOffline',(_0x3dfbfb,_0x216dd3)=>('connected'!==_0x3dfbfb&&(this['_shouldPluginsReconnect']=!0x0),_0x216dd3||_0x3dfbfb!==_0x47b369['CONNECTED']?_0x47b369['DISCONNECTED']:this['state']==_0x47b369['DISCONNECTED']&&this['_shouldPluginsReconnect']?(this['_shouldPluginsReconnect']=!0x1,this['_reconnect'](),_0x47b369['CONNECTING']):_0x47b369['CONNECTED'])),this['connection']['on']('error',(_0x5a5d96,_0x2572df)=>{if('limitExceeded'!==_0x2572df['code'])throw console['error'](_0x2572df),new _0x2bc765('cloudservices-init',null,{'originalError':_0x2572df});_0xb74de5['showWarning']('The\x20limit\x20of\x20maximum\x20concurrent\x20connections\x20that\x20the\x20collaboration\x20server\x20can\x20handle\x20has\x20been\x20reached.\x20Try\x20opening\x20the\x20document\x20again\x20in\x20a\x20few\x20minutes.\x20Please\x20contact\x20your\x20system\x20administrator\x20if\x20the\x20problem\x20persists.',{'title':'Connected\x20users\x20limit\x20exceeded','namespace':'real-time-collaboration'});}),!_0x171c08['me'])return new Promise(_0x1b7ad5=>_0x171c08['on']('change:me',_0x1b7ad5));})['catch'](_0x122b95=>{throw console['error'](_0x122b95),new _0x2bc765('cloudservices-init',null,{'originalError':_0x122b95});});}['addToReconnectionStack'](_0x523581){if('function'!=typeof _0x523581['reconnect'])throw new _0x2bc765('websocketgateway-invalid-plugin-interface',this);if(this['isInReconnectionStack'](_0x523581))throw new _0x2bc765('websocketgateway-plugin-already-registered',this,{'name':_0x523581['constructor']['pluginName']});this['_reconnectionStack']['add'](_0x523581);}['removeFromReconnectionStack'](_0x4df127){this['_reconnectionStack']['delete'](_0x4df127);}['isInReconnectionStack'](_0x5f36d6){return this['_reconnectionStack']['has'](_0x5f36d6);}['_reconnect'](){return this['connection']['reconnect']()['then'](()=>Promise['all'](Array['from'](this['_reconnectionStack'],_0x5b255e=>_0x5b255e['reconnect']())))['then'](()=>this['state']=_0x47b369['CONNECTED'])['catch'](_0x5c9e96=>{throw console['error'](_0x5c9e96),new _0x2bc765('cloudservices-reconnection-error',this['context']);});}['destroy'](){this['connection']&&this['connection']['disconnect'](),this['state']=_0x47b369['DISCONNECTED'],this['_domEmitter']['stopListening'](),super['destroy']();}}class r extends _0x51b4aa{['channelSessions'];['channelConnectedUsers'];['allConnectedUsers'];['_registeredSessions'];['_uniqueUsersCount'];['_users'];static get['pluginName'](){return'Sessions';}static get['requires'](){return[c,_0x2441e3];}constructor(_0x229c78){super(_0x229c78),this['channelSessions']=new Map(),this['channelConnectedUsers']=new Map(),this['allConnectedUsers']=new _0x5109e1(),this['_registeredSessions']=new Map(),this['_uniqueUsersCount']=0x0,this['_users']=this['context']['plugins']['get'](_0x2441e3);}['init'](){const _0x23f6ac=this['context']['plugins']['get'](c);this['listenTo'](_0x23f6ac,'change:state',(_0x24a000,_0x5f1867,_0x229d4f)=>{if('connected'!==_0x229d4f)this['channelSessions']['forEach'](_0x29061e=>_0x29061e['clear']()),this['channelConnectedUsers']['forEach'](_0x2dd0aa=>_0x2dd0aa['clear']()),this['allConnectedUsers']['clear']();else{for(const [_0x2f45bb,_0x4f9e56]of this['_registeredSessions'])for(const _0x596fb9 of _0x4f9e56)this['_handleSessionAdd'](_0x2f45bb,_0x596fb9);}}),this['_createUser'](_0x23f6ac['connection']['me'],!0x0);}['register'](_0x5623cd,_0x21b51b){if(this['_registeredSessions']['has'](_0x5623cd))throw new _0x2bc765('sessions-register-already-registered',null,{'channelId':_0x5623cd});this['_registeredSessions']['set'](_0x5623cd,_0x21b51b),this['channelSessions']['set'](_0x5623cd,new _0x5109e1()),this['channelConnectedUsers']['set'](_0x5623cd,new _0x5109e1()),this['listenTo'](_0x21b51b,'add',(_0x212569,_0x276a8c)=>this['_handleSessionAdd'](_0x5623cd,_0x276a8c)),this['listenTo'](_0x21b51b,'remove',(_0x374b56,_0x34870a)=>this['_handleSessionRemove'](_0x5623cd,_0x34870a));for(const _0x5a22f2 of _0x21b51b)this['_handleSessionAdd'](_0x5623cd,_0x5a22f2);}['unregister'](_0x3f7c29){if(!this['_registeredSessions']['has'](_0x3f7c29))throw new _0x2bc765('sessions-unregister-not-exist',null,{'channelId':_0x3f7c29});const _0x59fe16=this['_registeredSessions']['get'](_0x3f7c29);this['stopListening'](_0x59fe16);for(const _0x1a9e1c of _0x59fe16)'connected'===this['context']['plugins']['get'](c)['state']&&this['_handleSessionRemove'](_0x3f7c29,_0x1a9e1c);this['_registeredSessions']['delete'](_0x3f7c29),this['channelSessions']['delete'](_0x3f7c29),this['channelConnectedUsers']['delete'](_0x3f7c29);}get['mySessionId'](){return this['context']['plugins']['get'](c)['connection']['sessionId'];}['getUserBySessionId'](_0x41b1bd){for(const _0x20df62 of this['channelSessions']['values']())for(const _0x33e839 of _0x20df62)if(_0x33e839['id']===_0x41b1bd)return _0x33e839['user'];}['getUserSessions'](_0x71b8d6,_0xaf0c45){const _0x226a83=_0xaf0c45?[this['channelSessions']['get'](_0xaf0c45)]:this['channelSessions']['values'](),_0x5e0643=new Set();for(const _0x48caa1 of _0x226a83)for(const _0x76eab1 of _0x48caa1)_0x76eab1['user']['id']===_0x71b8d6['id']&&_0x5e0643['add'](_0x76eab1['id']);return _0x5e0643;}['getUserRole'](_0x2170dc){for(const _0xfdea0f of this['channelSessions']['values']())for(const _0x53c308 of _0xfdea0f)if(_0x53c308['user']===_0x2170dc)return _0x53c308['role'];}['_handleSessionAdd'](_0x134cf,_0x2cf1b3){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x53ffa7=_0x2cf1b3['user'],_0x46a1c5=this['_users']['getUser'](_0x53ffa7['id'])||this['_createUser'](_0x53ffa7),_0x5488fc=Object['assign']({},_0x2cf1b3,{'user':_0x46a1c5});this['channelSessions']['get'](_0x134cf)['add'](_0x5488fc);const _0x3a9e86=this['channelConnectedUsers']['get'](_0x134cf);_0x3a9e86['has'](_0x46a1c5['id'])||_0x3a9e86['add'](_0x46a1c5),this['allConnectedUsers']['has'](_0x46a1c5['id'])||this['allConnectedUsers']['add'](_0x46a1c5,_0x46a1c5['isMe']?0x0:void 0x0),this['fire']('sessionAdd:'+_0x134cf,{'channelId':_0x134cf,'session':_0x5488fc});}['_handleSessionRemove'](_0x2ad861,_0xe16140){if('connected'!==this['context']['plugins']['get'](c)['state'])return;const _0x47f12c=this['channelConnectedUsers']['get'](_0x2ad861),_0x5cdb95=_0xe16140['user'];_0x5cdb95['id']&&(this['channelSessions']['get'](_0x2ad861)['remove'](_0xe16140['id']),_0x47f12c['has'](_0x5cdb95['id'])&&!this['getUserSessions'](_0x5cdb95,_0x2ad861)['size']&&_0x47f12c['remove'](_0x5cdb95['id']),this['allConnectedUsers']['get'](_0x5cdb95['id'])&&!this['getUserSessions'](_0x5cdb95)['size']&&this['allConnectedUsers']['remove'](_0x5cdb95['id']));}['_createUser'](_0x4c51d0,_0x26102b){const _0x29321e=this['_users']['addUser'](_0x4c51d0);return _0x26102b&&this['_users']['defineMe'](_0x4c51d0['id']),_0x29321e['orderNumber']=this['_uniqueUsersCount']++,_0x29321e;}}class H extends _0x3f2414{['_domEmitter']=new(_0x46c19a())();static get['requires'](){return[r];}static get['pluginName'](){return'UserMarkers';}['init'](){const _0x514436=this['editor'],_0x2665b5=_0x514436['plugins']['get'](r);_0x514436['conversion']['for']('editingDowncast')['markerToElement']({'model':'user:position','view':(_0xbf1ab9,{writer:_0x212157})=>function(_0x21fe4c,_0x3e90fb,_0x2e318c,_0x376ed4){const _0x2062d3=_0x21fe4c['markerName']['split'](':')[0x2],_0x2eb580=_0x2e318c['getUserBySessionId'](_0x2062d3);if(!_0x2eb580||_0x2062d3===_0x2e318c['mySessionId'])return;if(!_0x376ed4['model']['schema']['checkChild'](_0x21fe4c['markerRange']['start'],'$text'))return;const _0x2fb4a1={'class':'ck-user__marker\x20'+_0x2eb580['color']['getMarkerClass'](),'data-name':_0x2eb580['name'],'data-session-id':_0x2062d3},_0x2ab4c3=_0x376ed4['model']['markers']['get'](_0x21fe4c['markerName']),_0x3f86e5=_0x2ab4c3['getStart'](),_0x11b8a0=_0x3f86e5['nodeAfter'],_0x49c81c=_0x376ed4['model']['schema'];if(_0x11b8a0&&_0x49c81c['isObject'](_0x11b8a0)&&_0x49c81c['isInline'](_0x11b8a0)&&!_0x376ed4['model']['markers']['get']('user:range:'+_0x2062d3)['getRange']()['isCollapsed'])return;const _0x2bb895=_0x3f86e5['parent'];return _0x376ed4['model']['schema']['isLimit'](_0x2bb895)&&!_0x376ed4['model']['hasContent'](_0x2bb895)&&(_0x2fb4a1['contenteditable']=!0x1),function(_0x190d82,_0x1019db,_0x48515a){const _0x4af48a=_0x190d82['createUIElement']('span',_0x1019db);return _0x190d82['setCustomProperty']('userPositionMarker',!0x0,_0x4af48a),_0x4af48a['render']=function(_0x269ae9){const _0x496d83=this['toDomElement'](_0x269ae9);return _0x496d83['innerHTML']='⁠<span\x20class=\x22ck-user__marker-line\x22\x20contenteditable=\x22false\x22><span\x20class=\x22ck-user__marker-dot\x22></span></span><span\x20class=\x22ck-user__marker-tooltip\x22\x20contenteditable=\x22false\x22\x20spellcheck=\x22false\x22>'+_0x48515a['name']+'</span>⁠',_0x496d83['addEventListener']('mouseenter',()=>{_0x496d83['classList']['add']('ck-user__marker_hovered');}),_0x496d83['addEventListener']('mouseleave',()=>{_0x496d83['classList']['remove']('ck-user__marker_hovered');}),_0x496d83;},_0x4af48a['isSimilar']=function(_0x5ce1b7){return!(!this['getCustomProperty']('userPositionMarker')||!_0x5ce1b7['getCustomProperty']('userPositionMarker')||this['getAttribute']('data-session-id')!=_0x5ce1b7['getAttribute']('data-session-id'));},_0x4af48a;}(_0x3e90fb,_0x2fb4a1,_0x2eb580);}(_0xbf1ab9,_0x212157,_0x2665b5,_0x514436)}),_0x514436['conversion']['for']('editingDowncast')['markerToHighlight']({'model':'user:range','view':_0x1419b2=>function(_0x1cce59,_0x1a55f1){const _0x1c1349=_0x1cce59['markerName']['split'](':')[0x2];if(_0x1c1349===_0x1a55f1['mySessionId'])return null;const _0x19d6e5=_0x1a55f1['getUserBySessionId'](_0x1c1349);if(!_0x19d6e5)return{'id':_0x1c1349,'classes':[]};return{'id':_0x1c1349,'classes':['ck-user__selection',_0x19d6e5['color']['getSelectionClass']()],'attributes':{'data-session-id':_0x1c1349},'priority':0x7d0+_0x19d6e5['orderNumber']};}(_0x1419b2,_0x2665b5)}),function(_0x2b9030){const _0x38a481=_0x2b9030['model'],_0xdbdf8b=new Map(),_0x261af7=_0x2b9030['plugins']['get'](r);_0x38a481['markers']['on']('update:user:range',(_0x4767d0,_0x48aded,_0x31fc9b,_0x4c79b4)=>{if(!_0x4c79b4&&_0xdbdf8b['get'](_0x48aded['name']))return _0xdbdf8b['get'](_0x48aded['name'])['detach'](),void _0xdbdf8b['delete'](_0x48aded['name']);const _0x45de15=_0x48aded['name']['split'](':')[0x2];if(_0x45de15===_0x261af7['mySessionId'])return;const _0x19048a='user:position:'+_0x45de15;_0x38a481['markers']['has'](_0x19048a)&&_0x2b9030['editing']['reconvertMarker'](_0x19048a),_0x48aded['on']('change:range',(_0x5df5dd,_0x49f1a6,_0x53d22b)=>{if('$graveyard'!=_0x49f1a6['root']['rootName']&&'$graveyard'==_0x48aded['getRange']()['root']['rootName']&&!_0xdbdf8b['has'](_0x48aded['name'])){const _0x456d9c=_0x38a481['schema']['getNearestSelectionRange'](_0x53d22b['deletionPosition']);if(_0x456d9c){const _0xe7bb8e=ht['fromRange'](_0x456d9c);_0xdbdf8b['set'](_0x48aded['name'],_0xe7bb8e),_0xe7bb8e['on']('change:range',(_0x24311d,_0x1bd6c3,_0x44d526)=>{if('$graveyard'==_0xe7bb8e['root']['rootName']){const _0x2f7b25=_0x38a481['schema']['getNearestSelectionRange'](_0x44d526['deletionPosition']);_0x2f7b25?(_0xe7bb8e['start']=_0x2f7b25['start'],_0xe7bb8e['end']=_0x2f7b25['end']):(_0xdbdf8b['delete'](_0x48aded['name']),_0xe7bb8e['detach']());}});}}});}),_0x38a481['document']['on']('change',()=>{_0xdbdf8b['size']>0x0&&_0x38a481['enqueueChange']({'isUndoable':!0x1},_0xe447f5=>{for(const [_0x469dc8,_0x1449b1]of _0xdbdf8b)'$graveyard'==_0x38a481['markers']['get'](_0x469dc8)['getRange']()['root']['rootName']&&(re(_0x469dc8['split'](':')[0x2],_0x1449b1['toRange'](),_0x38a481,_0xe447f5),_0x1449b1['detach']());_0xdbdf8b['clear']();});});}(_0x514436),this['_domEmitter']['listenTo'](_0x32b6fd['document'],'keydown',(_0x4baebb,{key:_0x3a7076})=>{'Escape'===_0x3a7076&&function(_0x3e68a0){_0x3e68a0['editing']['view']['change'](_0x3ffa1f=>{for(const _0x2df97b of _0x3e68a0['model']['markers']){if(!_0x2df97b['name']['startsWith']('user:position'))continue;const _0x470f7d=_0x3e68a0['editing']['mapper']['markerNameToElements'](_0x2df97b['name']);if(_0x470f7d){for(const _0x467b29 of _0x470f7d)_0x3ffa1f['removeClass']('ck-user__marker_hovered',_0x467b29);}}});}(_0x514436);},{'useCapture':!0x0});}['afterInit'](){const _0x9219fe=this['editor'],_0x11a7a6=_0x9219fe['commands']['get']('undo');_0x11a7a6&&_0x9219fe['model']['on']('applyOperation',(_0x5ce18d,_0x39c2b3)=>{const _0xf2057e=_0x39c2b3[0x0];if('marker'!=_0xf2057e['type']||!_0xf2057e['name']['startsWith']('user:'))return;const _0x31608d=_0xf2057e['batch'];_0x11a7a6['_createdBatches']['has'](_0x31608d)&&(_0xf2057e['newRange']=_0xf2057e['oldRange']?_0x9219fe['model']['createRange'](_0xf2057e['oldRange']['start'],_0xf2057e['oldRange']['end']):null);},{'priority':'highest'});}['destroy'](){return this['_domEmitter']['stopListening'](),super['destroy']();}['createUserMarkerOperations'](){const _0x27fee3=this['editor'],_0x42f278=_0x27fee3['model']['document'],_0x331a20=_0x27fee3['plugins']['get'](r);_0x27fee3['model']['enqueueChange']({'isUndoable':!0x1},_0x36c6e4=>{const _0x1b0b71='user:range:'+_0x331a20['mySessionId'],_0x3c2608='user:position:'+_0x331a20['mySessionId'],_0x3f8b46=_0x27fee3['model']['markers']['has'](_0x1b0b71);_0x27fee3['editing']['view']['hasDomSelection']?re(_0x331a20['mySessionId'],_0x42f278['selection']['getFirstRange'](),_0x27fee3['model'],_0x36c6e4):_0x3f8b46&&(_0x36c6e4['removeMarker'](_0x1b0b71),_0x36c6e4['removeMarker'](_0x3c2608));});}}function re(_0x58f2ee,_0x24f1b6,_0x42a0f4,_0x242775){const _0x277773='user:range:'+_0x58f2ee,_0x26b1b0='user:position:'+_0x58f2ee,_0x363c10=_0x24f1b6['getContainedElement']();let _0x35f7f7=_0x24f1b6['start'];_0x363c10&&_0x363c10['is']('element','tableCell')&&(_0x35f7f7=function(_0x1dfb90,_0x2c70a2){for(const _0x28c9f7 of _0x1dfb90['getPositions']())if(_0x2c70a2['schema']['checkChild'](_0x28c9f7,'$text'))return _0x28c9f7;}(_0x24f1b6,_0x42a0f4),_0x24f1b6=_0x242775['createRange'](_0x35f7f7));const _0x22df02=_0x242775['createRange'](_0x35f7f7);_0x42a0f4['markers']['has'](_0x277773)?(_0x242775['updateMarker'](_0x277773,{'range':_0x24f1b6}),_0x242775['updateMarker'](_0x26b1b0,{'range':_0x22df02})):(_0x242775['addMarker'](_0x277773,{'range':_0x24f1b6,'usingOperation':!0x0}),_0x242775['addMarker'](_0x26b1b0,{'range':_0x22df02,'usingOperation':!0x0}));}function q(_0x125c8c,_0x46a8ea,_0x444729){const t=_0x125c8c['t'];switch(_0x46a8ea){case'PENDING_ACTION_SENDING_DATA':return t({'string':'Sending\x20data\x20to\x20the\x20server.','id':'PENDING_ACTION_SENDING_DATA'});case'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.':return t('The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');case'Synchronization\x20issue':return t('Synchronization\x20issue');case'PENDING_ACTION_REVISION_HISTORY':return t({'string':'Unsaved\x20change\x20in\x20revision\x20history.','id':'PENDING_ACTION_REVISION_HISTORY'});case'CONNECTED_USERS':return t({'string':'1\x20connected\x20user\x20(me)','plural':'%0\x20connected\x20users','id':'CONNECTED_USERS'},_0x444729);default:return'';}}let K=0x1;class l extends _0x3f2414{static ['CollaborativeEditingService']=/* #__PURE__ -- @preserve */
((()=>_0x5168a7)());['_offset'];['sessionId'];['serverHistory'];['_channelId'];['_service'];['_document'];['_compressor'];['_bufferedOperations'];['_knownOperations'];['_knownRootNames'];['_pendingAction'];['_hasSelectionChanged'];['_sendBufferedOperationsDelayId'];['_baseBufferDelay'];['_currentBufferDelay'];['_lastSyncedOperationId'];['_disconnectionOperations'];['_operationIdentifier'];static get['requires'](){return[c,r,H,_0x37aea0,_0x2441e3,_0x29a42b];}static get['pluginName'](){return'RealTimeCollaborationClient';}get['cloudDocumentVersion'](){return this['_lastServerVersion']+this['_offset'];}get['_lastServerVersion'](){return this['serverHistory']['version']-this['_offset'];}get['lastSyncVersion'](){const _0x4885e3=this['serverHistory']['getOperations']();for(let _0x585381=_0x4885e3['length']-0x1;_0x585381>=0x0;_0x585381--){const _0x5ba3dc=_0x4885e3[_0x585381];if(!this['_disconnectionOperations']['has'](_0x5ba3dc))return _0x5ba3dc['baseVersion']+0x1-this['_offset'];}return 0x0;}constructor(_0x48dd18){if(super(_0x48dd18),this['_offset']=0x0,this['sessionId']=null,this['serverHistory']=new _0x437638(),this['editor']['config']['define']('collaboration',{}),this['_channelId']=this['editor']['config']['get']('collaboration.channelId'),!this['_channelId'])throw new _0x2bc765('collaboration-missing-channelid',this);const _0x17c3f2=_0x48dd18['config']['get']('cloudServices.bundleVersion')||nt;this['_service']=new l['CollaborativeEditingService'](_0x17c3f2,this['_channelId']),this['_document']=this['editor']['model']['document'],this['_compressor']=new _0xa38b1f(),this['_bufferedOperations']=[],this['_knownOperations']=new WeakSet(),this['_knownRootNames']=new Set(),this['set']('_isPendingUpdate',!0x1),this['set']('_hasSynchronizationProblem',!0x1),this['_pendingAction']=null,this['_hasSelectionChanged']=!0x1,this['_sendBufferedOperationsDelayId']=null,this['_baseBufferDelay']=0x12c,this['_currentBufferDelay']=this['_baseBufferDelay'],this['_lastSyncedOperationId']=null,this['_disconnectionOperations']=new WeakSet(),this['_operationIdentifier']=new X(this['_disconnectionOperations']);}['init'](){const _0x358b8a=this['editor'],_0x2efccc=_0x358b8a['plugins']['get'](_0x2441e3),_0x54707f=_0x358b8a['plugins']['get'](c);this['listenTo'](_0x2efccc,'getOperationAuthor',(_0x2ebbc5,_0x3ba275)=>{const _0x2c5092=_0x3ba275[0x0];_0x2c5092['_authorId']&&(_0x2ebbc5['return']=_0x2efccc['getUser'](_0x2c5092['_authorId']),_0x2ebbc5['stop']()),null===_0x2c5092['_authorId']&&(_0x2ebbc5['return']=null,_0x2ebbc5['stop']());},{'priority':'high'}),this['listenTo'](_0x358b8a['model']['document']['selection'],'change:range',(_0x276661,_0x1fe53f)=>{_0x1fe53f['directChange']&&this['_refreshUserSelectionMarkers']();}),this['listenTo'](_0x358b8a['editing']['view'],'change:hasDomSelection',()=>{this['_refreshUserSelectionMarkers']();}),this['_initThrowingOnDataSet'](),_0x358b8a['model']['on']('applyOperation',(_0x33d90e,_0x261f5d)=>{const _0x215432=_0x261f5d[0x0];_0x215432['isDocumentOperation']&&(this['_saveOperationInBuffer'](_0x215432),this['_shouldSendUpdate']()&&this['_sendBufferedOperationsDelayed']());}),this['_setUpDataInit'](),this['bind']('_isEditingAllowed')['to'](_0x54707f,'state',this,'_hasSynchronizationProblem',(_0x247fb1,_0x176555)=>'connected'===_0x247fb1&&!_0x176555),this['on']('change:_isEditingAllowed',()=>{this['_isEditingAllowed']?_0x358b8a['disableReadOnlyMode']('rtc-offline'):_0x358b8a['enableReadOnlyMode']('rtc-offline');}),this['_isEditingAllowed']?_0x358b8a['disableReadOnlyMode']('rtc-offline'):_0x358b8a['enableReadOnlyMode']('rtc-offline'),this['set']('_isConnected',!0x1);}async['reconnect'](){const _0x2143c2=this['editor']['plugins']['get'](r),_0xd5fa4a=this['editor']['plugins']['get'](c);try{this['_isPendingUpdate']=!0x0,_0x2143c2['unregister'](this['_channelId']);const _0x263c9d=await this['_service']['reconnect'](_0xd5fa4a['connection'],this['lastSyncVersion']);await this['_handleReconnectionResponse'](_0x263c9d)&&(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());const _0x581141=await this['_service']['getConnectedSessions']();_0x2143c2['register'](this['_channelId'],_0x581141),this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}catch(_0x5ee828){if(function(_0x436920){return'404'===_0x436920['code'];}(_0x5ee828)&&this['sessionId'])await this['_connectAfterSessionHasBeenFlushed']();else{if(function(_0xb4640a){return'409'===_0xb4640a['code'];}(_0x5ee828)){const _0x22f8d7=q(this['editor']['locale'],'The\x20document\x20cannot\x20be\x20connected\x20back\x20to\x20the\x20server.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x22f8d7);}else{if(!(_0x5ee828 instanceof J))throw _0x5ee828;this['_handleReconnectionError']();}}}}['destroy'](){const _0xe8881=this['editor']['plugins']['get'](c),_0x3418dc=this['editor']['plugins']['get'](r);this['editor']['enableReadOnlyMode']('rtc-destroyed'),_0x3418dc['channelSessions']['has'](this['_channelId'])&&_0x3418dc['unregister'](this['_channelId']),_0xe8881['removeFromReconnectionStack'](this),this['_disconnectService'](),super['destroy']();}async['_handleReconnectionResponse'](_0x26f46b){if(this['sessionId']!==_0x26f46b['sessionId']&&this['_lastSyncedOperationId']!==_0x26f46b['lastOperationId'])throw new J();return this['sessionId']=_0x26f46b['sessionId'],this['_handleServerResponse']([],{..._0x26f46b,'wereChangesApplied':!0x1,'data':_0x26f46b['data']},'reconnect');}async['_connectService'](_0x570199,_0x5b3e68=!0x1){const {connection:_0x46cbfd}=this['editor']['plugins']['get'](c);l['CollaborativeEditingService']['getConnectedSessions'](_0x46cbfd,this['_channelId'])['then'](_0x58f52d=>this['_initSessionsHandling'](_0x58f52d))['catch'](_0x146c8c=>{this['_crash']('realtimecollaborationclient-init-session-connection-error',_0x146c8c);}),this['listenTo'](this['_service'],'operationsReceived',this['_handleReceivedOperations']['bind'](this)),this['listenTo'](this['_service'],'error',(_0x597206,_0x1c3535)=>{this['_crash']('realtimecollaborationclient-initservice-internal-error',_0x1c3535);}),this['listenTo'](this['_service'],'disconnected',()=>{this['_isConnected']=!0x1;});const _0x1c9260=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x570199);this['_isPendingUpdate']=!0x0;const _0x1d9a9f=await this['_service']['connect'](_0x46cbfd,this['_compressOperations'](_0x570199),_0x1c9260);if(this['sessionId']=_0x1d9a9f['sessionId'],_0x5b3e68){if(!_0x1d9a9f['wereChangesApplied'])return void this['_handleReconnectionError']();this['_isPendingUpdate']=!0x1,this['_clearPendingAction'](),this['serverHistory']['reset'](),this['_offset']=_0x1d9a9f['offset'],this['serverHistory']['version']=this['_offset'],await this['_handleServerResponse'](_0x570199,_0x1d9a9f,'reconnection:\x20flushed\x20session');}else await this['_handleInitialConnectionData'](_0x1d9a9f,_0x570199);this['_handleSendingSelectionMarkers'](),this['_isConnected']=!0x0;}['_handleSendingSelectionMarkers'](){const _0x2463b1=this['editor']['plugins']['get'](r),_0x595fe2=this['editor']['plugins']['get'](H),_0x636757=_0x2463b1['channelSessions']['get'](this['_channelId']);_0x636757&&_0x636757['length']>0x1?_0x595fe2['createUserMarkerOperations']():this['listenTo'](_0x2463b1,'sessionAdd:'+this['_channelId'],()=>{0x2===_0x2463b1['channelSessions']['get'](this['_channelId'])['length']&&_0x595fe2['createUserMarkerOperations']();});}async['_handleReceivedOperations'](_0x57c09b,_0x34e487,_0x5ba972,_0x53860a){if(!this['_isPendingUpdate']&&this['_document']['version']==_0x34e487){const _0x1ec1a1=this['_decompressOperations'](_0x5ba972,_0x53860a);await this['_fetchMissingUsers'](_0x1ec1a1),this['_handleExternalOperations'](_0x1ec1a1,_0x34e487,_0x5ba972['lastOperationId'])||this['_crash']('realtimecollaborationclient-initservice-incorrect-server-operation');}}async['_connectAfterSessionHasBeenFlushed'](){this['_disconnectService']();const {locale:_0x1d975a}=this['editor'];let _0x5f0c85;try{_0x5f0c85=await this['_service']['getDocumentDetails']();}catch(_0x55c284){const _0x4e750d=q(_0x1d975a,'The\x20document\x20details\x20could\x20not\x20be\x20taken\x20during\x20the\x20reconnection.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');return void this['_handleReconnectionError'](_0x4e750d);}const _0x29866d=_0x5f0c85['currentDocumentSession']||_0x5f0c85['lastDocumentSession'];if(this['_lastSyncedOperationId']===_0x29866d['lastOperationId'])await this['_connectService'](this['editor']['model']['document']['history']['getOperations'](),!0x0);else{const _0x18b4a7=q(_0x1d975a,'The\x20last\x20saved\x20version\x20of\x20the\x20document\x20does\x20not\x20match\x20the\x20local\x20version.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.');this['_handleReconnectionError'](_0x18b4a7);}}['_disconnectService'](){this['_service']['disconnect'](),this['_bufferedOperations']=[],clearTimeout(this['_sendBufferedOperationsDelayId']),this['stopListening'](this['_service']);}['_initSessionsHandling'](_0x40495c){const _0x136230=this['editor']['plugins']['get'](r);this['listenTo'](_0x136230,'sessionAdd:'+this['_channelId'],(_0x27088f,{session:_0x437822})=>{if(_0x437822['id']===_0x136230['mySessionId']){_0x27088f['off']();const _0x57dcfb=this['editor']['plugins']['has']('CommentsOnly')&&this['editor']['plugins']['get']('CommentsOnly');let _0x40d467=_0x437822['permissions'];_0x57dcfb&&_0x57dcfb['isEnabled']&&(_0x40d467=_0x40d467['filter'](_0x243781=>'document:write'!==_0x243781)),this['editor']['plugins']['get']('Permissions')['setPermissions'](_0x40d467,this['_channelId']);}}),_0x136230['register'](this['_channelId'],_0x40495c);}['_initThrowingOnDataSet'](){const _0xb4a428=this['editor']['data']['set'];this['editor']['data']['set']=(..._0x4e71bf)=>{if(!_0x4e71bf[_0x4e71bf['length']-0x1]['suppressErrorInCollaboration'])throw new _0x2bc765('realtimecollaborationclient-editor-setdata-and-editor-data-set-are-forbidden-in-real-time-collaboration',this);_0xb4a428['apply'](this['editor']['data'],_0x4e71bf);};}['_setUpDataInit'](){this['editor']['data']['on']('init',(_0x293b5a,[_0x338651])=>{if(this['_document']['version'])throw new _0x2bc765('realtimecollaborationclient-init-document-already-initialized',this);_0x293b5a['stop'](),this['_setPendingAction']();const _0x3ba33f=this['editor']['config']['get']('rootsAttributes'),_0x171b38=this['_getOperationsFromInitData'](_0x338651,_0x3ba33f);0x0==_0x171b38['length']&&_0x171b38['push'](new _0x1d7bb6(0x0)),_0x293b5a['return']=this['_connectService'](_0x171b38)['then'](()=>{this['editor']['plugins']['get'](c)['addToReconnectionStack'](this),this['editor']['data']['fire']('ready');})['catch'](_0xc0c9ed=>this['_crash']('realtimecollaborationclient-init-connection-failed',_0xc0c9ed))['finally'](()=>this['_clearPendingAction']());},{'priority':'high'}),this['editor']['on']('loadRoot',async(_0x56b494,[_0x5dcf06,_0x5a7bfe])=>{_0x56b494['stop']();const _0xa169ca=this['editor']['model']['document']['getRoot'](_0x5dcf06);if(!this['_knownRootNames']['has'](_0x5dcf06)){const _0x523e4d=_0x5a7bfe&&_0x5a7bfe['data']?_0x5a7bfe['data']:'',_0x53a20d=_0x5a7bfe&&_0x5a7bfe['attributes']?_0x5a7bfe['attributes']:{};await this['_loadRoot'](_0x5dcf06,_0x523e4d,_0x53a20d);}this['editor']['model']['enqueueChange']({'isUndoable':!0x1},()=>{_0xa169ca['_isLoaded']=!0x0,this['editor']['model']['document']['differ']['_bufferRootLoad'](_0xa169ca);});},{'priority':'high'});}async['_fetchMissingUsers'](_0x279822){const _0x30e7dc=this['editor']['plugins']['get'](_0x2441e3),{connection:_0x5a0597}=this['editor']['plugins']['get'](c),_0x12deaa=new Set();for(const _0x57e385 of _0x279822){const _0x34a1fe=_0x57e385['_authorId'];_0x34a1fe&&!_0x30e7dc['getUser'](_0x34a1fe)&&_0x12deaa['add'](_0x34a1fe);}if(0x0===_0x12deaa['size'])return;const _0x347ead=await dt['getMany'](_0x5a0597,Array['from'](_0x12deaa));for(const _0x4793eb of _0x347ead)_0x30e7dc['getUser'](_0x4793eb['id'])||_0x30e7dc['addUser'](_0x4793eb);}['_getOperationsFromInitData'](_0x203d6e,_0x432282={}){const _0x2563e3=this['editor']['model'],_0x475d9c=[];let _0xdf39b2=0x0;const _0x4e28e8='string'==typeof _0x203d6e?{'main':_0x203d6e}:_0x203d6e;for(const _0x55c10e of Object['keys'](_0x4e28e8)){if(!this['_document']['roots']['has'](_0x55c10e))throw new _0x2bc765('realtimecollaborationclient-init-non-existent-root',this);const _0x3a7bad=this['editor']['data']['parse'](_0x4e28e8[_0x55c10e]),_0x469811=this['_document']['getRoot'](_0x55c10e),_0x2985a5=new _0x55de0c(_0x2563e3['createPositionAt'](_0x469811,0x0),_0x3a7bad,_0xdf39b2++);_0x475d9c['push'](_0x2985a5);for(const [_0x5ce1d5,_0x3aa006]of _0x3a7bad['markers']){const _0x33b538=_0x2563e3['createRange'](_0x2563e3['createPositionFromPath'](_0x469811,_0x3aa006['start']['path']['slice']()),_0x2563e3['createPositionFromPath'](_0x469811,_0x3aa006['end']['path']['slice']())),_0x4ddd47=new _0x493d42(_0x5ce1d5,null,_0x33b538,_0x2563e3['markers'],!0x0,_0xdf39b2++);_0x475d9c['push'](_0x4ddd47);}}if(_0x432282)for(const [_0x53cf50,_0x3f7fc7]of Object['entries'](_0x432282)){const _0x117420=_0x2563e3['document']['getRoot'](_0x53cf50);if(!_0x117420)throw new _0x2bc765('multi-root-editor-root-attributes-no-root',null);for(const [_0x1a8030,_0x4978e1]of Object['entries'](_0x3f7fc7))if(null!==_0x4978e1){const _0x3c2543=new _0x32919d(_0x117420,_0x1a8030,null,_0x4978e1,_0xdf39b2++);_0x475d9c['push'](_0x3c2543);}}return _0x475d9c;}async['_loadRoot'](_0x546d88,_0x45f6c1,_0x226ffa){this['_getOperationsFromInitData']({[_0x546d88]:_0x45f6c1},{[_0x546d88]:_0x226ffa})['forEach']((_0x4b9c52,_0x52692b)=>{_0x4b9c52['baseVersion']=this['_document']['version']+_0x52692b,_0x4b9c52['_isInit']=!0x0,this['_saveOperationInBuffer'](_0x4b9c52);}),this['_sendBufferedOperationsDelayed'](),await this['_waitUntilSynced']();}async['_handleInitialConnectionData'](_0x478053,_0x28e6e3){let _0x5296fd;this['_offset']=_0x478053['offset'];const _0x46d8b3=_0x478053['wereChangesApplied']&&!_0x478053['initData'],_0x32bdd5=_0x46d8b3?0x0:_0x478053['data']['baseVersion'];if(_0x28e6e3['forEach'](_0x46e5e6=>{_0x46e5e6['_isInit']=!0x0,_0x46e5e6['createdAt']=_0x478053['sessionCreatedAt'],_0x46e5e6['_authorId']=null;}),_0x46d8b3)_0x5296fd=_0x28e6e3,this['_applyOperationsSet'](_0x5296fd,_0x46d8b3);else{if(_0x478053['initData']){const _0x1e5d90=this['_getOperationsFromInitData'](_0x478053['initData']);this['_document']['history']['version']=-_0x1e5d90['length'],_0x1e5d90['forEach'](_0x2742f6=>{_0x2742f6['baseVersion']-=_0x1e5d90['length'],_0x2742f6['createdAt']=_0x478053['sessionCreatedAt'],_0x2742f6['_isInit']=!0x0,_0x2742f6['_authorId']=null;}),this['_applyOperationsSet'](_0x1e5d90,!0x0),this['serverHistory']['version']=-_0x1e5d90['length']+this['_offset'],this['_updateServerHistory'](_0x1e5d90);}this['_document']['history']['version']=_0x32bdd5,_0x5296fd=this['_decompressOperations'](_0x478053['data'],_0x478053['metadata']),await this['_fetchMissingUsers'](_0x5296fd),this['_applyOperationsSet'](_0x5296fd,_0x46d8b3);}_0x478053['lastOperationId']&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x5296fd,_0x478053['lastOperationId']),this['_lastSyncedOperationId']=_0x478053['lastOperationId']),this['serverHistory']['version']=_0x32bdd5+this['_offset'],this['_updateServerHistory'](_0x5296fd),_0x28e6e3['filter'](_0x34dc39=>{const _0x1b303b=this['_getAffectedRoot'](_0x34dc39);return _0x1b303b&&!this['_knownRootNames']['has'](_0x1b303b);})['forEach']((_0x59d350,_0xed1998)=>{_0x59d350['baseVersion']=this['_document']['version']+_0xed1998,this['_saveOperationInBuffer'](_0x59d350);}),this['_shouldSendUpdate']()?(this['_currentBufferDelay']=0x0,this['_sendBufferedOperationsDelayed'](!0x0),await this['_waitUntilSynced']()):(this['_isPendingUpdate']=!0x1,this['_clearPendingAction']());}['_crash'](_0x509440,_0x7d6a6b){throw this['_isPendingUpdate']=!0x0,_0x7d6a6b&&console['error'](_0x7d6a6b),new _0x2bc765(_0x509440,this['editor']);}['_saveOperationInBuffer'](_0x10f47b){this['_knownOperations']['has'](_0x10f47b)||(this['_knownOperations']['add'](_0x10f47b),this['_bufferedOperations']['push'](_0x10f47b),this['_pendingAction']||'marker'==_0x10f47b['type']&&!_0x10f47b['affectsData']||this['_setPendingAction']());}['_sendBufferedOperationsDelayed'](_0x547820=!0x1){!_0x547820&&this['_isPendingUpdate']||(this['_isPendingUpdate']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_sendBufferedOperationsDelayId']=setTimeout(()=>{this['_sendBufferedOperations']()['then'](_0x1fc68c=>{_0x1fc68c&&(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1);})['catch'](_0x1aaf87=>{if(this['_clearPendingAction'](),this['_isPendingUpdate']=!0x1,!function(_0xe87078){return _0xe87078['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0xe87078['message']['startsWith']('cloud-services-internal-error:\x20Collaborative\x20Editing\x20Service\x20is\x20not\x20connected.')||_0xe87078['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}(_0x1aaf87))throw _0x1aaf87;});},this['_currentBufferDelay']));}['_waitUntilSynced'](){return new Promise(_0xb37c69=>{this['on']('change:_isPendingUpdate',()=>{_0xb37c69();});});}async['_sendBufferedOperations'](){const _0x46dda6=this['editor']['plugins']['get'](H);if(this['_shouldSendSelectionUpdate']()&&(_0x46dda6['createUserMarkerOperations'](),this['_hasSelectionChanged']=!0x1),!this['_shouldSendUpdate']())return!0x0;const _0x19a217=[...this['_bufferedOperations']];for(const _0x5ec426 of _0x19a217)_0x5ec426['wasUndone']=this['_document']['history']['isUndoneOperation'](_0x5ec426);const _0x495d21=this['_operationIdentifier']['getIdOfTheLastOperation'](_0x19a217),_0x82a608=K++,_0x3436cd=this['_compressOperations'](_0x19a217),_0xe9ef47=await this['_service']['sendOperations'](_0x3436cd,_0x3436cd['baseVersion'],_0x495d21);try{return await this['_handleServerResponse'](_0x19a217,_0xe9ef47,_0x82a608);}catch(_0x28946a){return this['_crash']('realtimecollaborationclient-sendbufferedoperations',_0x28946a);}}async['_handleServerResponse'](_0x2098d8,_0x31a40c,_0x316534){if('error'in _0x31a40c)throw _0x31a40c['error'];let _0x4da0ad=!0x1;if(_0x31a40c['wereChangesApplied']){_0x31a40c['lastOperationId']&&(this['_lastSyncedOperationId']=_0x31a40c['lastOperationId']),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x5567a9=>!_0x2098d8['includes'](_0x5567a9));for(const _0x16a409 of _0x2098d8)_0x16a409['createdAt']='lastOperationAcceptedAt'in _0x31a40c&&_0x31a40c['lastOperationAcceptedAt']||void 0x0;Q(_0x2098d8,_0x31a40c['version']-_0x2098d8['length']),this['_updateServerHistory'](_0x2098d8);const _0x128992=_0x2098d8['filter'](_0x11bbd0=>{if(!_0x11bbd0['_isInit'])return!0x1;const _0x1e6b8f=this['_getAffectedRoot'](_0x11bbd0);return _0x1e6b8f&&!this['_knownRootNames']['has'](_0x1e6b8f);});Q(_0x128992,this['_document']['version']),this['_applyOperationsSet'](_0x128992),_0x4da0ad=!0x0,this['_currentBufferDelay']=this['_baseBufferDelay'];}else{const _0x435515=this['_decompressOperations'](_0x31a40c['data'],_0x31a40c['metadata'])['filter'](_0x161207=>_0x161207['baseVersion']>=this['_lastServerVersion']);_0x435515['forEach'](_0x4c3890=>this['_addKnownRoot'](_0x4c3890)),this['_bufferedOperations']=this['_bufferedOperations']['filter'](_0x33e73d=>!_0x33e73d['_isInit']||!this['_knownRootNames']['has'](this['_getAffectedRoot'](_0x33e73d))),this['_bufferedOperations']['length']&&Q(this['_bufferedOperations'],this['_bufferedOperations'][0x0]['baseVersion']),await this['_fetchMissingUsers'](_0x435515),_0x4da0ad=this['_handleExternalOperations'](_0x435515,_0x31a40c['version'],_0x31a40c['lastOperationId']),this['_currentBufferDelay']=Math['round'](this['_currentBufferDelay']/0x2);}return _0x4da0ad?!this['_shouldSendUpdate']()||(this['_sendBufferedOperationsDelayed'](!0x0),!0x1):this['_crash']('realtimecollaborationclient-handleserverresponse');}['_handleExternalOperations'](_0x11f527,_0x5129ae,_0x38ad39){try{const _0x34bded={'document':this['_document'],'useRelations':!0x1,'padWithNoOps':!0x0},{operationsA:_0x1db98e,operationsB:_0x37662f,originalOperations:_0x4b9232}=_0xaa48ff(_0x11f527,this['_bufferedOperations'],_0x34bded);Q(_0x1db98e,this['_document']['version']),Q(_0x37662f,_0x5129ae);for(const _0x329f3c of _0x1db98e){const _0x48473f=_0x4b9232['get'](_0x329f3c);_0x329f3c['_authorId']=_0x48473f?_0x48473f['_authorId']:null;}_0x38ad39&&(this['_operationIdentifier']['setIdForTheLastOperation'](_0x11f527,_0x38ad39),this['_lastSyncedOperationId']=_0x38ad39),this['_bufferedOperations']=[..._0x37662f],this['_applyOperationsSet'](_0x1db98e),this['_updateServerHistory'](_0x11f527);}catch(_0x56fdad){return console['error'](_0x56fdad),!0x1;}return!0x0;}['_applyOperationsSet'](_0x42d4e0,_0x1a813e=!0x1){this['editor']['model']['enqueueChange']({'isUndoable':!0x1,'isLocal':!0x1},_0x3c6a63=>{for(const _0x175db3 of _0x42d4e0)this['_knownOperations']['add'](_0x175db3),this['_addKnownRoot'](_0x175db3),_0x3c6a63['batch']['addOperation'](_0x175db3),this['editor']['model']['applyOperation'](_0x175db3);});}['_addKnownRoot'](_0x101b67){const _0x80c895=this['_getAffectedRoot'](_0x101b67);_0x80c895&&this['_knownRootNames']['add'](_0x80c895);}['_getAffectedRoot'](_0x58ee50){let _0x52646f,_0x3ef846;switch(_0x58ee50['type']){case'insert':_0x52646f=_0x58ee50['position']['root'];break;case'marker':if(_0x3ef846=_0x58ee50['newRange'],!_0x3ef846)return null;_0x52646f=_0x3ef846['root'];break;case'addRootAttribute':_0x52646f=_0x58ee50['root'];break;case'addRoot':_0x52646f=_0x58ee50['affectedSelectable'];break;case'move':_0x52646f=_0x58ee50['targetPosition']['root'];break;default:return null;}return _0x52646f['rootName'];}['_updateServerHistory'](_0x4214ca){_0x4214ca['forEach'](_0x3c15eb=>{const _0x4ddd37=_0x3c15eb['clone']();_0x4ddd37['_authorId']=_0x3c15eb['_authorId'],_0x4ddd37['_isInit']=!!_0x3c15eb['_isInit'],_0x4ddd37['createdAt']=_0x3c15eb['createdAt'],_0x4ddd37['baseVersion']+=this['_offset'],_0x3c15eb['_isDisconnection']&&this['_disconnectionOperations']['add'](_0x4ddd37),this['serverHistory']['addOperation'](_0x4ddd37);});}['_handleReconnectionError'](_0x405458){const _0x5a901b=this['editor']['plugins']['get']('Notification'),_0x5b8796=this['editor']['locale'];_0x405458||(_0x405458=q(_0x5b8796,'The\x20local\x20document\x20and\x20server\x20document\x20differ\x20and\x20merging\x20them\x20can\x20cause\x20unexpected\x20behavior.\x20To\x20not\x20lose\x20your\x20content\x20save\x20it\x20locally\x20and\x20refresh\x20the\x20editor.')),_0x5a901b['showWarning'](_0x405458,{'title':q(_0x5b8796,'Synchronization\x20issue'),'namespace':'real-time-collaboration'}),this['_hasSynchronizationProblem']=!0x0,clearTimeout(this['_sendBufferedOperationsDelayId']),this['_bufferedOperations']=[],this['editor']['plugins']['get'](c)['destroy']();}['_setPendingAction'](){this['_pendingAction']||(this['_pendingAction']=this['editor']['plugins']['get'](_0x37aea0)['add'](q(this['editor']['locale'],'PENDING_ACTION_SENDING_DATA')));}['_clearPendingAction'](){this['_pendingAction']&&(this['editor']['plugins']['get'](_0x37aea0)['remove'](this['_pendingAction']),this['_pendingAction']=null);}['_compressOperations'](_0x4d230a){const _0x24d8d1=_0x4d230a['map'](_0x2212e8=>_0x2212e8['toJSON']());return this['_compressor']['compress'](_0x24d8d1);}['_decompressOperations'](_0x3bb2d9,_0x56b97a){return this['_compressor']['decompress'](_0x3bb2d9)['map']((_0x497625,_0x330a56)=>{const _0x537d25='init'==_0x56b97a[_0x330a56]['type'];if('InsertOperation'==_0x497625['__className']){const _0x5c61e3=_0x497625['position']['root'];!this['_document']['getRoot'](_0x5c61e3)&&(this['_document']['createRoot']('$root',_0x5c61e3)['_isAttached']=!0x1);}const _0x4dfe97=_0x5002ae['fromJSON'](_0x497625,this['_document']);return _0x4dfe97['wasUndone']=_0x497625['wasUndone'],_0x4dfe97['_isInit']=_0x537d25,_0x4dfe97['_authorId']=_0x537d25?null:_0x56b97a[_0x330a56]['userId'],_0x4dfe97['_isDisconnection']='cs:removeUser'===_0x56b97a[_0x330a56]['type'],_0x4dfe97['createdAt']=_0x56b97a[_0x330a56]['createdAt'],_0x4dfe97;});}['_refreshUserSelectionMarkers'](){this['_hasSelectionChanged']=!0x0,this['_shouldSendSelectionUpdate']()?this['_sendBufferedOperationsDelayed']():this['_hasSelectionChanged']=!0x1;}['_shouldSendSelectionUpdate'](){const _0x318eea=this['editor']['plugins']['get'](r)['channelSessions']['get'](this['_channelId']);return!this['editor']['isReadOnly']&&!!_0x318eea&&_0x318eea['length']>0x1&&this['_hasSelectionChanged'];}['_shouldSendUpdate'](){return this['_bufferedOperations']['length']>0x0||this['_shouldSendSelectionUpdate']();}}class J extends Error{}function Q(_0x34f77f,_0x2a456f){for(const _0x331786 of _0x34f77f)_0x331786['baseVersion']=_0x2a456f++;}class X{['_ignoredOperations'];['_operationToId'];constructor(_0x344f43){this['_ignoredOperations']=_0x344f43,this['_operationToId']=new WeakMap();}['getIdOfTheLastOperation'](_0x1759b6){let _0x1b2f65=_0x1759b6['length'];for(;_0x1b2f65--;){const _0x3baa75=_0x1759b6[_0x1b2f65];if(!this['_ignoredOperations']['has'](_0x3baa75)){if(!this['_operationToId']['has'](_0x3baa75)){const _0x215226=_0x4976cf()['slice'](0x1,0x12);this['_operationToId']['set'](_0x3baa75,_0x215226);}return this['_operationToId']['get'](_0x3baa75);}}}['setIdForTheLastOperation'](_0x22a7fb,_0x2e6679){if(!_0x2e6679)return;let _0x2b964f=_0x22a7fb['length'];for(;_0x2b964f--;){const _0x1be428=_0x22a7fb[_0x2b964f];this['_ignoredOperations']['has'](_0x1be428)||this['_operationToId']['set'](_0x1be428,_0x2e6679);}}}class n extends _0x3f2414{static get['requires'](){return[l];}static get['pluginName'](){return'RealTimeCollaborativeEditing';}}class a extends _0x51b4aa{static ['CommentsService']=/* #__PURE__ -- @preserve */
((()=>_0x34e845)());['_services'];static get['requires'](){return[c,'CommentsRepository',r,_0x2441e3];}static get['pluginName'](){return'CloudServicesCommentsAdapter';}constructor(_0x5017ba){super(_0x5017ba),this['_services']=new Map();}async['init'](){const _0x1a2ac2=this['context'],_0x5f5499=_0x1a2ac2['plugins']['get']('CommentsRepository');if(_0x1a2ac2['plugins']['get'](c)['addToReconnectionStack'](this),_0x5f5499['adapter']={'addCommentThread':async({channelId:_0x29a6fa,threadId:_0x3ffe14,comments:_0x164e4c,resolvedAt:_0xdc0199,resolvedBy:_0x452420,context:_0x28ad3c,attributes:_0x5a9f0e})=>{const _0x346fb2=await this['_getService'](_0x29a6fa)['addCommentThread']({'commentThreadId':_0x3ffe14,'comments':_0x164e4c['map'](_0x332450=>function(_0x426499,_0x27ef23,_0x3f9539){return{'commentThreadId':_0x3f9539,'commentId':_0x426499['commentId'],'userId':_0x426499['authorId'],'content':_0x426499['content'],'documentId':_0x27ef23,'createdAt':_0x426499['createdAt'],'attributes':_0x426499['attributes']||{}};}(_0x332450,_0x29a6fa,_0x3ffe14)),'resolvedAt':_0xdc0199,'resolvedBy':_0x452420,'context':_0x28ad3c,'attributes':_0x5a9f0e})['catch'](lt);return{'threadId':_0x346fb2['commentThreadId'],'comments':_0x346fb2['comments']};},'getCommentThread':async({channelId:_0xb8f32c,threadId:_0x252599})=>{const _0x1d9a80=await this['_getService'](_0xb8f32c)['getCommentThread'](_0x252599)['catch'](lt);return await this['_fetchMissingUsersForThreads']([_0x1d9a80]),{'threadId':_0x1d9a80['commentThreadId'],'comments':_0x1d9a80['comments']['map'](R),'context':_0x1d9a80['context'],'resolvedAt':_0x1d9a80['resolvedAt'],'resolvedBy':_0x1d9a80['resolvedBy'],'attributes':_0x1d9a80['attributes']||{}};},'updateCommentThread':async({channelId:_0x1f2259,threadId:_0x3f1f7d,context:_0x3aa8be,unlinkedAt:_0x45fc54,attributes:_0x19eeca})=>this['_getService'](_0x1f2259)['updateCommentThread']({'commentThreadId':_0x3f1f7d,'context':_0x3aa8be,'attributes':_0x19eeca,'unlinkedAt':_0x45fc54})['catch'](F)['catch'](lt),'resolveCommentThread':async({channelId:_0x51a43f,threadId:_0x124fc0})=>{const _0x1e6c6a=await this['_getService'](_0x51a43f)['resolveCommentThread'](_0x124fc0)['catch'](F)['catch'](lt);return{'threadId':_0x1e6c6a['commentThreadId'],'resolvedAt':_0x1e6c6a['resolvedAt'],'resolvedBy':_0x1e6c6a['resolvedBy']};},'reopenCommentThread':async({channelId:_0x570425,threadId:_0x6b2e9a})=>this['_getService'](_0x570425)['reopenCommentThread'](_0x6b2e9a)['catch'](F)['catch'](lt),'removeCommentThread':({channelId:_0x16b954,threadId:_0x27684e})=>this['_getService'](_0x16b954)['removeCommentThread'](_0x27684e)['catch'](F)['catch'](lt),'addComment':({channelId:_0x3135ca,threadId:_0x587510,commentId:_0x4f3116,content:_0x14332d,attributes:_0xd4c867})=>this['_getService'](_0x3135ca)['addComment'](_0x587510,_0x4f3116,_0x14332d,_0xd4c867)['catch'](lt),'updateComment':({channelId:_0x532b70,threadId:_0x11a667,commentId:_0x20aca5,content:_0x3a1f65,attributes:_0x49eac8})=>this['_getService'](_0x532b70)['updateComment'](_0x11a667,_0x20aca5,_0x3a1f65,_0x49eac8)['catch'](F)['catch'](lt),'removeComment':({channelId:_0x21078f,threadId:_0x4c7243,commentId:_0x3ca65c})=>this['_getService'](_0x21078f)['removeComment'](_0x4c7243,_0x3ca65c)['catch'](F)['catch'](lt)},_0x1a2ac2 instanceof _0x4feb74){const _0x5e7ee8=_0x1a2ac2['config']['get']('collaboration.channelId'),_0x3422bb=_0x1a2ac2['plugins']['get'](r);await this['_setUpService'](_0x5e7ee8);const _0x5d5291=await this['_services']['get'](_0x5e7ee8)['getConnectedSessions']();this['listenTo'](_0x3422bb,'sessionAdd:'+_0x5e7ee8,(_0x13520c,{session:_0x2215e9})=>{_0x2215e9['id']===_0x3422bb['mySessionId']&&(_0x13520c['off'](),this['context']['plugins']['get']('Permissions')['setPermissions'](_0x2215e9['permissions'],_0x5e7ee8));}),_0x3422bb['register'](_0x5e7ee8,_0x5d5291);}}async['_setUpService'](_0x284b34){if(this['_services']['has'](_0x284b34))throw new _0x2bc765('cloudservicescommentsadapter-connect-already-connected',null,{'channelId':_0x284b34});const _0x1a9452=this['context']['plugins']['get']('CommentsRepository'),_0x3860ab=new a['CommentsService'](_0x284b34);this['_services']['set'](_0x284b34,_0x3860ab),this['listenTo'](_0x3860ab,'commentThreadAdded',(_0x43bc9a,_0x4d13b7)=>{const {commentThreadId:_0x1b63a5,documentId:_0x512908,context:_0x5e59d2,attributes:_0xd9b00b,resolvedAt:_0x4f4a68,resolvedBy:_0x1a859e,comments:_0x170e95}=_0x4d13b7;_0x1a9452['getCommentThread'](_0x1b63a5)||_0x1a9452['addCommentThread']({'threadId':_0x1b63a5,'channelId':_0x512908,'comments':_0x170e95?_0x170e95['map'](R):[],'context':_0x5e59d2,'attributes':_0xd9b00b,'resolvedAt':_0x4f4a68,'resolvedBy':_0x1a859e,'isFromAdapter':!0x0});}),this['listenTo'](_0x3860ab,'commentThreadUpdated',(_0x2a1dfe,{commentThreadId:_0x14bfe4,documentId:_0x4c1ca4,context:_0xc713cb,unlinkedAt:_0x3cd354,attributes:_0x59035d})=>{_0x1a9452['getCommentThread'](_0x14bfe4)&&_0x1a9452['updateCommentThread']({'threadId':_0x14bfe4,'channelId':_0x4c1ca4,'context':_0xc713cb,'unlinkedAt':_0x3cd354,'attributes':_0x59035d,'isFromAdapter':!0x0});}),this['listenTo'](_0x3860ab,'commentThreadResolved',(_0x499787,{commentThreadId:_0xdb18f1,resolvedBy:_0x736a1a,resolvedAt:_0x204703})=>{const _0x635c01=_0x1a9452['getCommentThread'](_0xdb18f1);_0x635c01&&_0x635c01['resolve']({'resolvedBy':_0x736a1a,'resolvedAt':_0x204703,'isFromAdapter':!0x0});}),this['listenTo'](_0x3860ab,'commentThreadReopened',(_0x29fcda,{commentThreadId:_0x28c322})=>{const _0xc85354=_0x1a9452['getCommentThread'](_0x28c322);_0xc85354&&_0xc85354['reopen']({'isFromAdapter':!0x0});}),this['listenTo'](_0x3860ab,'commentThreadRemoved',(_0x45245d,{commentThreadId:_0x1b9c23})=>{const _0x19e74f=_0x1a9452['getCommentThread'](_0x1b9c23);_0x19e74f&&_0x19e74f['remove']({'isFromAdapter':!0x0});}),this['listenTo'](_0x3860ab,'commentAdded',(_0x43c28f,_0x530bc9)=>{const _0x107a46=_0x530bc9['commentThreadId'],_0x594cdb=_0x1a9452['getCommentThread'](_0x107a46);_0x594cdb&&_0x594cdb['addComment']({...R(_0x530bc9),'isFromAdapter':!0x0});}),this['listenTo'](_0x3860ab,'commentUpdated',(_0x45f000,{commentThreadId:_0x266155,commentId:_0x4cfee4,content:_0x3de3b7,attributes:_0x30ea2a})=>{const _0x1554fe=_0x1a9452['getCommentThread'](_0x266155);if(_0x1554fe){const _0x5afbac=_0x1554fe['getComment'](_0x4cfee4);_0x5afbac&&_0x5afbac['update']({'content':_0x3de3b7,'attributes':_0x30ea2a,'isFromAdapter':!0x0});}}),this['listenTo'](_0x3860ab,'commentRemoved',(_0x13ca37,{commentThreadId:_0x44d424,commentId:_0x2db684})=>{const _0x29917b=_0x1a9452['getCommentThread'](_0x44d424);if(_0x29917b){const _0x195445=_0x29917b['getComment'](_0x2db684);_0x195445&&_0x195445['remove']({'isFromAdapter':!0x0});}}),await this['_connectService'](_0x284b34);}['destroy'](){if(this['context']instanceof _0x4feb74){const _0x2cb8f7=this['context']['config']['get']('collaboration.channelId');this['_terminateService'](_0x2cb8f7);}}['_terminateService'](_0x3a4129){if(!this['_services']['has'](_0x3a4129))throw new _0x2bc765('cloudservicescommentsadapter-disconnect-not-exist',null,{'channelId':_0x3a4129});this['_getService'](_0x3a4129)['disconnect'](),this['_services']['delete'](_0x3a4129);}async['reconnect'](){for(const _0x42175c of this['_services']['keys']())await this['_connectService'](_0x42175c);if(this['context']instanceof _0x4feb74){const _0x407a06=this['context']['config']['get']('collaboration.channelId'),_0x3c49e2=this['context']['plugins']['get'](r);_0x3c49e2['unregister'](_0x407a06);const _0xfe7254=await this['_services']['get'](_0x407a06)['getConnectedSessions']();_0x3c49e2['register'](_0x407a06,_0xfe7254);}}async['_connectService'](_0x5938ac){const {connection:_0x54ae97}=this['context']['plugins']['get'](c),_0x308a3b=this['context']['plugins']['get']('CommentsRepository'),_0x919fd5=this['_services']['get'](_0x5938ac),_0x52abf7=await _0x919fd5['connect'](_0x54ae97);await this['_fetchMissingUsersForThreads'](_0x52abf7);const _0x4c004f=new Set(Array['from'](_0x308a3b['getCommentThreads']({'channelId':_0x5938ac}),_0x140714=>_0x140714['id']));for(const _0x38fca4 of _0x52abf7)_0x38fca4['deletedAt']||_0x4c004f['delete'](_0x38fca4['commentThreadId']);for(const _0x4e66fc of _0x4c004f)_0x308a3b['getCommentThread'](_0x4e66fc)['remove']({'isFromAdapter':!0x0});for(const _0x343857 of _0x52abf7){let _0x328749=_0x308a3b['getCommentThread'](_0x343857['commentThreadId']);const {commentThreadId:_0x593786,context:_0x1897e4,attributes:_0x18c9ea,resolvedBy:_0x2c31d8,resolvedAt:_0x48684c,unlinkedAt:_0x1d1866,deletedAt:_0x440ead}=_0x343857;if(_0x440ead)continue;_0x328749||(_0x328749=_0x308a3b['addCommentThread']({'channelId':_0x5938ac,'threadId':_0x593786,'context':_0x1897e4,'attributes':_0x18c9ea||{},'resolvedBy':_0x2c31d8,'resolvedAt':_0x48684c,'unlinkedAt':_0x1d1866,'isFromAdapter':!0x0}));const _0x23f8d3=new Set(Array['from'](_0x328749['comments'],_0x9e3215=>_0x9e3215['id']));for(const _0x338bca of _0x343857['comments'])_0x23f8d3['delete'](_0x338bca['commentId']);for(const _0x5462b1 of _0x23f8d3)_0x328749['getComment'](_0x5462b1)['remove']({'isFromAdapter':!0x0});for(const _0x4d9526 of _0x343857['comments']){const _0x4bd32b=_0x328749['getComment'](_0x4d9526['commentId']);_0x4bd32b?_0x4bd32b['content']!==_0x4d9526['content']&&_0x4bd32b['update']({'content':_0x4d9526['content'],'isFromAdapter':!0x0}):_0x328749['addComment'](Object['assign'](R(_0x4d9526),{'isFromAdapter':!0x0}));}}}['_getService'](_0x5a9dd1){if(!this['_services']['has'](_0x5a9dd1))throw new _0x2bc765('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x5a9dd1});return this['_services']['get'](_0x5a9dd1);}async['_fetchMissingUsersForThreads'](_0x42ca87){const _0x515abd=this['context']['plugins']['get'](_0x2441e3),{connection:_0x54830a}=this['context']['plugins']['get'](c),_0x39b792=new Set();for(const {resolvedBy:_0x14dea1,comments:_0x33ee2a}of _0x42ca87){_0x14dea1&&!_0x515abd['getUser'](_0x14dea1)&&_0x39b792['add'](_0x14dea1);for(const {userId:_0xe79c73}of _0x33ee2a)_0x515abd['getUser'](_0xe79c73)||_0x39b792['add'](_0xe79c73);}if(0x0===_0x39b792['size'])return;const _0xff2cf6=await dt['getMany'](_0x54830a,Array['from'](_0x39b792));for(const _0x50a7f9 of _0xff2cf6)_0x515abd['getUser'](_0x50a7f9['id'])||_0x515abd['addUser'](_0x50a7f9);}}async function F(_0x237664){if('404'!==_0x237664['code'])throw _0x237664;}function lt(_0x31b5a3){if((_0x41b40e=_0x31b5a3)['message']['startsWith']('cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.')||_0x41b40e['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x41b40e['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.'))return new Promise(()=>{});var _0x41b40e;throw _0x31b5a3;}function R(_0x30171d){return{'threadId':_0x30171d['commentThreadId'],'commentId':_0x30171d['commentId'],'content':_0x30171d['content'],'createdAt':_0x30171d['createdAt'],'authorId':_0x30171d['userId'],'attributes':_0x30171d['attributes']||{}};}class g extends _0x3f2414{static ['TrackChangesService']=/* #__PURE__ -- @preserve */
((()=>et)());['_bufferedRequests'];['_trackChangesService'];static get['requires'](){return[a,'TrackChangesEditing',c];}constructor(_0x4ec52a){super(_0x4ec52a);const _0x1c8625=this['editor']['config']['get']('collaboration.channelId');this['_bufferedRequests']=new Map(),this['_trackChangesService']=new g['TrackChangesService'](_0x1c8625);}['init'](){const _0x1b0946=this['editor']['plugins']['get'](c),_0x3c61cb=this['editor']['plugins']['get']('TrackChangesEditing');return _0x3c61cb['adapter']={'getSuggestion':async _0x30dbda=>{await this['_waitForServiceReady']();const _0x4d02f0=await this['_trackChangesService']['get'](_0x30dbda)['catch'](B);return await this['_fetchMissingUsersForThreads']([_0x4d02f0]),_0x4d02f0;},'addSuggestion':async({id:_0x1a8333,type:_0x47209d,data:_0x2c94fd,originalSuggestionId:_0x271251,attributes:_0x22f09a})=>{await this['_waitForServiceReady']();const _0x477a66={'id':_0x1a8333,'type':_0x47209d,'data':_0x2c94fd,'originalSuggestionId':_0x271251,'attributes':_0x22f09a},_0x54e063=await this['_trackChangesService']['add'](_0x1a8333,_0x47209d,_0x2c94fd,_0x271251,_0x22f09a)['catch'](_0x487fa5=>{if(ut(_0x487fa5))return new Promise(_0x3e1d96=>{this['_bufferedRequests']['set'](_0x1a8333,{'resolve':_0x3e1d96,'suggestionData':_0x477a66});});throw _0x487fa5;});return this['_bufferedRequests']['delete'](_0x1a8333),_0x54e063;},'updateSuggestion':async(_0x42765c,_0x5b4253)=>{if(await this['_waitForServiceReady'](),'open'!==_0x5b4253['state'])return this['_trackChangesService']['update'](_0x42765c,_0x5b4253)['catch'](B);}},this['listenTo'](this['_trackChangesService'],'suggestionUpdated',(_0x355dc8,_0x805d4f)=>{_0x3c61cb['hasSuggestion'](_0x805d4f['id'])&&(_0x3c61cb['getSuggestion'](_0x805d4f['id'])['attributes']=_0x805d4f['attributes']);}),this['_trackChangesService']['connect'](_0x1b0946['connection'])['then'](_0x4d11b4=>(_0x1b0946['addToReconnectionStack'](this),this['_fetchMissingUsersForThreads'](_0x4d11b4)['then'](()=>{for(const _0x5534ae of _0x4d11b4){_0x3c61cb['addSuggestionData'](_0x5534ae)['_saved']=!0x0;}})));}async['reconnect'](){const _0x57d1ff=this['editor']['plugins']['get']('TrackChangesEditing'),{connection:_0xa3090c}=this['editor']['plugins']['get'](c),_0x3bfdf5=await this['_trackChangesService']['connect'](_0xa3090c);await this['_fetchMissingUsersForThreads'](_0x3bfdf5);for(const {suggestionData:_0x206666,resolve:_0x19ff34}of this['_bufferedRequests']['values']()){let _0x4a7e24=_0x3bfdf5['find'](_0x5d8a95=>_0x5d8a95['id']===_0x206666['id']);_0x4a7e24||(_0x4a7e24=await this['_trackChangesService']['add'](_0x206666['id'],_0x206666['type'],_0x206666['data'],_0x206666['originalSuggestionId'])),_0x19ff34(_0x4a7e24);}for(const _0x24aa05 of _0x3bfdf5)_0x57d1ff['hasSuggestion'](_0x24aa05['id'])||_0x57d1ff['addSuggestionData'](_0x24aa05);}async['_waitForServiceReady'](){this['_trackChangesService']['isConnected']||await new Promise(_0x18e764=>{this['listenTo'](this['_trackChangesService'],'connected',_0x46505e=>{_0x46505e['off'](),_0x18e764();});});}async['_fetchMissingUsersForThreads'](_0x1d0431){const _0x3f7c55=this['editor']['plugins']['get'](_0x2441e3),{connection:_0x64e205}=this['editor']['plugins']['get'](c),_0x155425=new Set();for(const {authorId:_0x33761c}of _0x1d0431)_0x3f7c55['getUser'](_0x33761c)||_0x155425['add'](_0x33761c);if(0x0===_0x155425['size'])return;const _0xa46300=await dt['getMany'](_0x64e205,Array['from'](_0x155425));for(const _0x49bcc8 of _0xa46300)_0x3f7c55['getUser'](_0x49bcc8['id'])||_0x3f7c55['addUser'](_0x49bcc8);}}function B(_0x5823d2){if(ut(_0x5823d2))return new Promise(()=>{});throw _0x5823d2;}function ut(_0x2cf3fa){return _0x2cf3fa['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x2cf3fa['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class m extends _0x3f2414{static get['requires'](){return['Comments',a,n,c];}static get['pluginName'](){return'RealTimeCollaborativeComments';}['init'](){const _0x134d39=this['editor']['plugins']['get'](c),_0x27f8df=this['editor']['plugins']['get']('CommentsEditing'),_0x10111f=this['editor']['plugins']['get'](a);return this['editor']['data']['once']('ready',()=>{this['listenTo'](_0x134d39,'change:state',(_0x4fe0f1,_0x17c0ed,_0x249cbb)=>{_0x27f8df['isThreadsLoadingPaused']='connected'!==_0x249cbb;});}),this['listenTo'](_0x134d39,'change:state',(_0x22f610,_0x1e9103,_0x4c3846)=>{this['editor']['plugins']['get']('CommentsRepository')['switchReadOnly']('connected'!==_0x4c3846);}),_0x10111f['_setUpService'](this['editor']['config']['get']('collaboration.channelId'));}['destroy'](){this['editor']['plugins']['get'](a)['_terminateService'](this['editor']['config']['get']('collaboration.channelId')),super['destroy']();}}class p extends _0x3f2414{static get['requires'](){return[m,g,'TrackChanges'];}static get['pluginName'](){return'RealTimeCollaborativeTrackChanges';}}class v extends _0x3f2414{static ['RevisionHistoryService']=/* #__PURE__ -- @preserve */
((()=>it)());['_lastRequestId'];['_revisionTracker'];['_revisionHistoryService'];['_oldOffset'];static get['requires'](){return[c,l,'RevisionTracker',r,_0x2441e3];}constructor(_0x3477fb){super(_0x3477fb);const _0xe63bf9=this['editor']['config']['get']('collaboration.channelId');this['_lastRequestId']=null,this['_revisionTracker']=this['editor']['plugins']['get']('RevisionTracker'),this['_revisionHistoryService']=new v['RevisionHistoryService'](_0xe63bf9);}async['init'](){const _0x3e3528=this['editor']['plugins']['get'](l),_0x419a2d=_0x3e3528['serverHistory'],_0x3bd9ec=this['editor']['plugins']['get'](c);this['_revisionTracker']['setSource']({'history':_0x419a2d,'getLatestVersion':()=>this['_getLatestVersion'](),'getCurrentRevisionId':()=>_0x3e3528['sessionId']});const _0x32ce9=this['editor']['config']['get']('cloudServices.bundleVersion')||nt,_0x5e1372=await tt['isBundleUploaded'](_0x3bd9ec['connection'],_0x32ce9);this['_revisionTracker']['adapter']={'getRevision':async({revisionId:_0x198a7d})=>(await this['_waitForServiceReady'](),await this['_revisionHistoryService']['getRevision'](_0x198a7d)),'updateRevisions':async _0x52b20e=>{await this['_waitForServiceReady']();const _0x21d317=this['_revisionTracker']['currentRevision'];if(_0x5e1372&&0x1===_0x52b20e['length']&&_0x52b20e[0x0]['id']===_0x21d317['id'])return _0x52b20e;for(const _0xc80765 of _0x52b20e)_0xc80765['id']===_0x21d317['id']&&(_0xc80765['isEmptyCurrent']=_0xc80765['fromVersion']===_0xc80765['toVersion']);return this['_revisionHistoryService']['updateRevisions'](_0x52b20e,this['_lastRequestId'])['then'](_0x59c8a7=>(this['_lastRequestId']=_0x59c8a7,_0x52b20e))['catch'](_0x49cfec=>{if(st(_0x49cfec)||'400'===_0x49cfec['code']&&void 0x0!==_0x49cfec['data']['wrongRequestId']){for(const _0x29c982 of _0x52b20e){!this['_revisionTracker']['repository']['getRevision'](_0x29c982['id'])||this['_revisionTracker']['_bufferUpdate'](_0x29c982['id'],_0x29c982,!0x1);}if(st(_0x49cfec))throw _0x49cfec;return _0x52b20e;}throw _0x49cfec;});}},this['listenTo'](this['_revisionHistoryService'],'revisionsUpdated',(_0x5b16cc,{revisionsData:_0x4b2533,requestId:_0xed2200})=>{Math['max'](..._0x4b2533['map'](_0xcd0614=>_0xcd0614['toVersion']))>this['_getLatestVersionFromServerOperations']()-0x1?this['_getLatestVersion']()['then'](()=>{this['_handleRevisionsUpdate'](_0x4b2533,_0xed2200);}):this['_handleRevisionsUpdate'](_0x4b2533,_0xed2200);});const {revisions:_0x4ef0c9,requestId:_0x14c3c5}=await this['_revisionHistoryService']['connect'](_0x3bd9ec['connection']);_0x3bd9ec['addToReconnectionStack'](this),this['_lastRequestId']=_0x14c3c5,await this['_fetchMissingUsers'](_0x4ef0c9);for(const _0x18ecdc of _0x4ef0c9)this['_revisionTracker']['addRevisionData'](_0x18ecdc);this['listenTo'](_0x3e3528,'change:_isConnected',(_0x47b12e,_0x1d317b,_0x36c898)=>{_0x36c898&&(this['_oldOffset']=_0x3e3528['_offset'],_0x47b12e['off']());}),this['_revisionTracker']['bind']('isEnabled')['to'](_0x3bd9ec,'state',_0x2aead2=>_0x2aead2===_0x47b369['CONNECTED']);}async['reconnect'](){const _0x52c388=this['editor']['plugins']['get'](c),_0x53025f=this['editor']['plugins']['get'](l),_0x3bc896=async()=>{const _0x276234=this['_revisionTracker']['currentRevision'],_0x13973c=_0x276234['id'],_0x43a64b=_0x13973c!==_0x53025f['sessionId'];if(_0x43a64b){const _0x2b304e=_0x53025f['_offset']-this['_oldOffset'],_0x5c8924=this['_getLatestVersionFromServerOperations']();this['_revisionTracker']['_revisionDataBuilder']['reInit']();if(_0x276234['toVersion']+_0x2b304e!==_0x5c8924){const _0x5ddce8=_0x276234['fromVersion']+_0x2b304e,_0xc6487d=this['editor']['plugins']['get'](_0x2441e3),_0x3d37bd=this['_revisionTracker']['buildRevisionData']({'revision':_0x276234,'from':_0x5ddce8,'to':_0x5c8924});_0x3d37bd['id']=_0x276234['id'];const _0x190960=_0x3d37bd['authorsIds']['map'](_0x2aa185=>_0xc6487d['getUser'](_0x2aa185));_0x276234['_update']({..._0x3d37bd,'authors':_0x190960},!0x0),this['_revisionTracker']['_bufferUpdate'](_0x276234['id'],_0x3d37bd,!0x0);}this['_revisionTracker']['_startingVersion']=_0x5c8924,(_0x276234['toVersion']===_0x276234['fromVersion']&&!this['_revisionTracker']['_bufferedUpdates']['has'](_0x13973c)&&this['_revisionTracker']['repository']['_revisions']['remove'](_0x13973c),this['_revisionTracker']['_createCurrentRevision'](_0x5c8924));}const {revisions:_0x5ade8e,requestId:_0x5962b7}=await this['_revisionHistoryService']['reconnect'](_0x52c388['connection'],this['_lastRequestId']);_0x43a64b&&_0x5ade8e['length']>0x0?_0x53025f['_handleReconnectionError']():(await this['_fetchMissingUsers'](_0x5ade8e),this['_handleRevisionsUpdate'](_0x5ade8e,_0x5962b7),this['_revisionTracker']['sendBufferedUpdates']());};return _0x53025f['_isConnected']?_0x3bc896():new Promise((_0xdb2511,_0x4c074b)=>{_0x53025f['once']('change:_isConnected',()=>{_0x3bc896()['then'](_0xdb2511)['catch'](_0x4c074b);});});}['destroy'](){super['destroy']();}async['_waitForServiceReady'](){this['_revisionHistoryService']['isConnected']||await new Promise(_0x97372e=>{this['listenTo'](this['_revisionHistoryService'],'connected',_0x2fbc6e=>{_0x2fbc6e['off'](),_0x97372e();});});}['_getLatestVersionFromServerOperations'](){const _0x4172a9=this['editor']['plugins']['get'](l)['serverHistory']['getOperations']()['reverse']();for(const _0x43705c of _0x4172a9)if('marker'!==_0x43705c['type']||_0x43705c['affectsData'])return _0x43705c['baseVersion']+0x1;}['_getLatestVersion'](){const _0x2fc555=this['editor']['plugins']['get'](l);return new Promise(_0x56ff4d=>{_0x2fc555['_isPendingUpdate']?_0x2fc555['once']('change:_isPendingUpdate',()=>{_0x56ff4d(this['_getLatestVersionFromServerOperations']());}):_0x56ff4d(this['_getLatestVersionFromServerOperations']());});}['_handleRevisionsUpdate'](_0x5f0811,_0x4da782){const _0x525024=this['_revisionTracker']['repository'];this['_lastRequestId']=_0x4da782;for(const _0x2f373d of _0x5f0811){const _0x1a2b40=_0x525024['getRevision'](_0x2f373d['id']);if(_0x1a2b40){if((_0x2f373d['fromVersion']||_0x2f373d['toVersion'])&&(_0x2f373d['diffData']=null),_0x1a2b40===this['_revisionTracker']['currentRevision']){const _0x1ba6f9=Math['max'](_0x1a2b40['toVersion'],_0x2f373d['toVersion']),_0x465379=Math['max'](_0x1a2b40['fromVersion'],_0x2f373d['fromVersion']);let _0x18aed6;_0x1a2b40['toVersion']===_0x2f373d['toVersion']&&_0x1a2b40['fromVersion']===_0x2f373d['fromVersion']?(_0x18aed6=!0x0,this['_preventResendingRevisionData'](_0x2f373d)):_0x2f373d['toVersion']===_0x1ba6f9&&_0x2f373d['fromVersion']===_0x465379?_0x18aed6=!0x1:(_0x1a2b40['toVersion']===_0x1ba6f9&&_0x1a2b40['fromVersion']===_0x465379||this['_fixRevision']({'revision':_0x1a2b40,'from':_0x465379,'to':_0x1ba6f9}),_0x18aed6=!0x0),_0x18aed6&&(delete _0x2f373d['fromVersion'],delete _0x2f373d['toVersion'],delete _0x2f373d['diffData'],delete _0x2f373d['createdAt'],delete _0x2f373d['authorsIds']);}this['_revisionTracker']['setRevisionData'](_0x2f373d),this['_preventResendingRevisionData'](_0x2f373d);}else this['_revisionTracker']['addRevisionData'](_0x2f373d);}const _0x3ecf4a=_0x525024['getRevisions']();_0x3ecf4a['reverse']();for(let _0x50d66f=0x0;_0x50d66f<_0x3ecf4a['length']-0x1;_0x50d66f++){const _0x57bc14=_0x3ecf4a[_0x50d66f],_0x5d705b=_0x3ecf4a[_0x50d66f+0x1];if(_0x57bc14['fromVersion']<_0x5d705b['toVersion']){const _0x36d4aa=_0x5d705b['toVersion'],_0x2861a4=Math['max'](_0x36d4aa,_0x57bc14['toVersion']);this['_fixRevision']({'revision':_0x57bc14,'from':_0x36d4aa,'to':_0x2861a4});}}}['_fixRevision']({revision:_0x678e19,from:_0x2b8592,to:_0x302fb2}={}){const _0x3435a6=this['editor']['plugins']['get'](_0x2441e3),_0x53c0f7=this['_revisionTracker']['buildRevisionData']({'revision':_0x678e19,'from':_0x2b8592,'to':_0x302fb2});_0x53c0f7['authors']=_0x53c0f7['authorsIds']['map'](_0x178672=>_0x3435a6['getUser'](_0x178672)),_0x678e19['_update'](_0x53c0f7);}['_preventResendingRevisionData'](_0x64d243){const _0x3222bc={};_0x3222bc['id']=_0x64d243['id'];for(const _0x39fe2c of Object['keys'](_0x64d243))'id'!==_0x39fe2c&&(_0x3222bc[_0x39fe2c]=void 0x0);this['_revisionTracker']['_bufferUpdate'](_0x3222bc['id'],_0x3222bc,!0x0);}async['_fetchMissingUsers'](_0x1c1798){const _0x265845=this['editor']['plugins']['get'](_0x2441e3),{connection:_0x438581}=this['editor']['plugins']['get'](c),_0x2cf2c7=new Set();for(const _0x3ae264 of _0x1c1798){for(const _0x1c5496 of _0x3ae264['authorsIds'])_0x440fd1(_0x1c5496);_0x3ae264['creatorId']&&_0x440fd1(_0x3ae264['creatorId']);}if(0x0===_0x2cf2c7['size'])return;const _0xa47361=await dt['getMany'](_0x438581,Array['from'](_0x2cf2c7));for(const _0x429c4d of _0xa47361)_0x265845['getUser'](_0x429c4d['id'])||_0x265845['addUser'](_0x429c4d);function _0x440fd1(_0x5ace3c){_0x265845['getUser'](_0x5ace3c)||_0x2cf2c7['add'](_0x5ace3c);}}}function st(_0x535030){return _0x535030['message']['startsWith']('cloud-services-internal-error:\x20Revision\x20History\x20Service\x20is\x20not\x20connected.')||_0x535030['message']['startsWith']('cloud-services-internal-error:\x20Not\x20connected.')||_0x535030['message']['startsWith']('cloud-services-internal-error:\x20Request\x20timeout.');}class d extends _0x3f2414{static get['requires'](){return['RevisionHistory',v,n];}static get['pluginName'](){return'RealTimeCollaborativeRevisionHistory';}}class ts extends _0x3f2a09{constructor(_0x3566cb){super(_0x3566cb);const _0x3a4b0e=this['bindTemplate'];this['set']('usersCount',0x0),this['set']('isHidden',!0x0),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__counter',_0x3a4b0e['if']('isHidden','ck-presence-list__counter--hidden')]},'children':[{'text':_0x3a4b0e['to']('usersCount',_0x265f18=>q(_0x3566cb,'CONNECTED_USERS',_0x265f18))}]});}}class rt extends _0x3f2a09{['items'];constructor(_0x555cf5){super(_0x555cf5),this['items']=this['createCollection']();const _0x2362f3=this['bindTemplate'];this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__list']},'children':this['items'],'on':{'click':_0x2362f3['to'](()=>this['fire']('execute'))}});}}class k extends _0x3f2a09{['counterView'];['inlineListView'];constructor(_0xf8dbd6){super(_0xf8dbd6);const _0x27cfac=this['bindTemplate'];this['set']('isCollapsed',!0x0),this['counterView']=new ts(this['locale']),this['inlineListView']=new rt(_0xf8dbd6),this['listenTo'](this['inlineListView']['items'],'change',()=>{for(const _0x3b6e5f of this['inlineListView']['items'])_0x3b6e5f['tooltipPosition']='s';this['inlineListView']['items']['first']&&(this['inlineListView']['items']['first']['tooltipPosition']='se');}),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list','ck-reset','ck-rounded-corners',_0x27cfac['if']('isCollapsed','ck-presence-list--collapsed')]},'children':[this['counterView'],this['inlineListView']]});}}class x extends _0x3f2a09{['items'];constructor(_0x958af3){super(_0x958af3),this['items']=this['createCollection'](),this['setTemplate']({'tag':'div','attributes':{'class':['ck','ck-presence-list__dropdown-list']},'children':[{'tag':'div','attributes':{'class':['ck','ck-presence-list__dropdown-list-wrapper']},'children':this['items']}]});}}class y extends _0x3f2a09{['userView'];constructor(_0x47a501,_0x565837,_0x5a6fb7){super(_0x47a501);const _0x2ab290=this['bindTemplate'];this['userView']=new ct(_0x47a501,_0x565837);const _0x8b54dc={'tag':'div','attributes':{'class':['ck','ck-presence-list__dropdown-list-item']},'children':[this['userView'],{'tag':'span','attributes':{'class':['ck','ck-user__full-name']},'children':[{'text':_0x565837['name']}]},{'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x565837['color']['getBackgroundColorClass']()],'aria-hidden':'true'}}]};_0x5a6fb7&&(_0x8b54dc['tag']='button',_0x8b54dc['on']={'click':_0x2ab290['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0x8b54dc);}}class A extends _0x3f2a09{['userView'];['markerView'];constructor(_0x494d9b,_0x7e7a76,_0x43c8ea){super(_0x494d9b);const _0x90e330=this['bindTemplate'];this['set']('hasTooltip',!0x0),this['set']('tooltipPosition',''),this['userView']=new ct(_0x494d9b,_0x7e7a76),this['markerView']=new ot(_0x494d9b,_0x7e7a76);const _0x524e98={'tag':'div','attributes':{'class':['ck','ck-presence-list__list-item'],'data-cke-tooltip-text':this['userView']['name'],'data-cke-tooltip-position':_0x90e330['to']('tooltipPosition'),'data-cke-tooltip-disabled':_0x90e330['to']('hasTooltip',_0xf9e8b4=>!_0xf9e8b4),'data-cke-tooltip-class':'ck-presence-list__list-item__tooltip'},'children':[this['userView'],this['markerView']]};_0x43c8ea&&(_0x524e98['tag']='button',_0x524e98['on']={'click':_0x90e330['to'](()=>this['fire']('execute'))}),this['setTemplate'](_0x524e98);}}class ot extends _0x3f2a09{constructor(_0x496146,_0x35cce5){super(_0x496146),this['setTemplate']({'tag':'span','attributes':{'class':['ck','ck-presence-list__marker',_0x35cce5['color']['getBackgroundColorClass']()],'aria-hidden':'true'}});}}const _={'collapseAt':0x6,'displayMe':!0x0};class s extends _0x51b4aa{['currentDisplayedUsers'];['balloonPanelView'];['view'];['presenceDropdownView'];['_bodyCollection'];constructor(_0x5eb3fd){super(_0x5eb3fd),this['context']['config']['define']('presenceList',_);const _0x181301=_0x5eb3fd['config']['get']('presenceList.collapseAt');if('number'!=typeof _0x181301)throw new _0x2bc765('presencelist-collapseat-invalid-format',this);if(_0x181301<0x1)throw new _0x2bc765('presencelist-collapseat-invalid-format',this);this['_allConnectedUsers']=this['context']['plugins']['get'](r)['allConnectedUsers'],this['set']('usersCount',0x0),this['currentDisplayedUsers']=new _0x5109e1(),this['balloonPanelView']=new _0x389e13(),this['balloonPanelView']['class']='ck\x20ck-presence-list__balloon',this['view']=this['_createView'](),this['presenceDropdownView']=void 0x0;}static get['requires'](){return[r];}['init'](){for(const _0x13bd1d of this['_allConnectedUsers'])this['_handleUserAdd'](_0x13bd1d);this['listenTo'](this['_allConnectedUsers'],'add',(_0x433840,_0x347124)=>{this['_handleUserAdd'](_0x347124);}),this['listenTo'](this['_allConnectedUsers'],'remove',(_0x4bdffe,_0x3b221f)=>{this['_handleUserRemove'](_0x3b221f);});}['_createView'](){const _0x371708=this['context'],_0x468d81=new k(this['context']['locale']),_0x3562df=this['balloonPanelView'];if(!_0x189686(_0x371708['config']['get']('presenceList.container')))throw new _0x2bc765('presencelist-missing-container',this);return _0x468d81['counterView']['bind']('usersCount')['to'](this),_0x468d81['bind']('isCollapsed')['to'](this,'usersCount',_0x3ba7f1=>{const {collapseAt:_0x18f3db,displayMe:_0x478eaf}=_0x371708['config']['get']('presenceList'),_0x3119ca=_0x3ba7f1>=_0x18f3db;return _0x468d81['counterView']['isHidden']=!(0x1==_0x3ba7f1&&_0x478eaf||_0x3119ca),_0x3119ca||this['hideDropdown'](),_0x3119ca;}),_0x468d81['inlineListView']['items']['bindTo'](this['currentDisplayedUsers'])['using'](_0x30734d=>{const _0x32d7db=_0x371708['config']['get']('presenceList'),_0x3cefa6=new A(_0x371708['locale'],_0x30734d,!!_0x32d7db['onClick']);return _0x3cefa6['bind']('hasTooltip')['to'](_0x468d81,'isCollapsed',_0x428622=>!_0x428622),_0x32d7db['onClick']&&this['listenTo'](_0x3cefa6,'execute',()=>{this['view']['isCollapsed']||_0x32d7db['onClick'](_0x30734d,_0x3cefa6['element']);}),_0x3cefa6;}),this['listenTo'](_0x468d81['inlineListView'],'execute',()=>{this['presenceDropdownView']?this['hideDropdown']():this['view']['isCollapsed']&&this['showDropdown']();}),_0x468d81['render'](),_0x3562df['render'](),_0x3bdd20({'emitter':_0x468d81,'activator':()=>_0x3562df['isVisible'],'contextElements':[_0x3562df['element'],_0x468d81['inlineListView']['element']],'callback':()=>this['hideDropdown']()}),_0x371708['config']['get']('presenceList.container')['appendChild'](_0x468d81['element']),this['_bodyCollection']=new _0x587dfd(this['context']['locale']),this['_bodyCollection']['attachToDom'](),this['_bodyCollection']['add'](_0x3562df),_0x468d81;}['_handleUserAdd'](_0x3b8054){if(!this['context']['config']['get']('presenceList.displayMe')&&_0x3b8054['isMe'])return;const _0x408933=this['context']['config']['get']('presenceList.collapseAt')-0x1;this['usersCount']++,this['currentDisplayedUsers']['length']==_0x408933&&this['currentDisplayedUsers']['remove'](0x0);const _0x32a205=this['_calculateNewUserPosition'](_0x3b8054);this['currentDisplayedUsers']['add'](_0x3b8054,_0x32a205);}['_handleUserRemove'](_0x3083e5){if(this['usersCount']--,this['currentDisplayedUsers']['get'](_0x3083e5['id'])&&(this['currentDisplayedUsers']['remove'](_0x3083e5['id']),this['currentDisplayedUsers']['length']<this['usersCount'])){for(const _0x27cd19 of Array['from'](this['_allConnectedUsers'])['reverse']())if(!this['currentDisplayedUsers']['get'](_0x27cd19['id']))return void this['currentDisplayedUsers']['add'](_0x27cd19,0x0);}}['_calculateNewUserPosition'](_0x23adf3){return Boolean(this['currentDisplayedUsers']['last']&&this['currentDisplayedUsers']['last']['isMe'])&&!_0x23adf3['isMe']?this['currentDisplayedUsers']['length']-0x1:this['currentDisplayedUsers']['length'];}['showDropdown'](){if(this['presenceDropdownView'])return;this['presenceDropdownView']=new x(this['context']['locale']);const _0x84e831=this['context']['config']['get']('presenceList');this['presenceDropdownView']['items']['bindTo'](this['_allConnectedUsers'])['using'](_0x2d9004=>{if(!_0x84e831['displayMe']&&_0x2d9004['isMe'])return null;const _0x542ead=new y(this['context']['locale'],_0x2d9004,!!_0x84e831['onClick']);return _0x84e831['onClick']&&this['listenTo'](_0x542ead,'execute',()=>{_0x84e831['onClick'](_0x2d9004,_0x542ead['element']);}),_0x542ead;}),this['balloonPanelView']['content']['add'](this['presenceDropdownView']),this['balloonPanelView']['pin']({'target':this['view']['inlineListView']['element']});}['hideDropdown'](){this['presenceDropdownView']&&(this['balloonPanelView']['unpin'](),this['balloonPanelView']['content']['remove'](this['presenceDropdownView']),this['presenceDropdownView']['destroy'](),this['presenceDropdownView']=void 0x0);}['destroy'](){super['destroy'](),this['view']&&this['view']['isRendered']&&this['view']['destroy'](),this['_bodyCollection']&&this['_bodyCollection']['detachFromDom']();}}class i extends _0x51b4aa{static get['requires'](){return[r,s];}static get['pluginName'](){return'PresenceList';}}export{a as CloudServicesCommentsAdapter,v as CloudServicesRevisionHistoryAdapter,g as CloudServicesTrackChangesAdapter,i as PresenceList,l as RealTimeCollaborationClient,m as RealTimeCollaborativeComments,n as RealTimeCollaborativeEditing,d as RealTimeCollaborativeRevisionHistory,p as RealTimeCollaborativeTrackChanges};