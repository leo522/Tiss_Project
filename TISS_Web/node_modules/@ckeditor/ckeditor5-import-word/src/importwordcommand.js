/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Command as _0xa77eee}from'ckeditor5/src/core.js';import{Range as _0x182694}from'ckeditor5/src/engine.js';import{logWarning as _0x1ddec9,logError as _0x19da58,first as _0x29b4f4,uid as _0x37f1dd}from'ckeditor5/src/utils.js';export default class d extends _0xa77eee{constructor(_0x515ddf){super(_0x515ddf),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x5aa32b,_0x20811f)=>{const _0x207162=new DataTransfer();_0x207162['setData']('text/html',_0x20811f['html']);const _0x2bc38a=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x536d73=>{this['_importMarker']['stopListening'](),_0x536d73['setSelection'](_0x2bc38a),_0x515ddf['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x207162});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0xb4dc3d,_0x472d49={}){if(this['isBusy'])return Promise['resolve']();const _0x1f14ff=this['editor']['config']['get']('importWord'),_0x46e58f={'url':_0x1f14ff['converterUrl'],'file':_0xb4dc3d,'serviceConfig':{..._0x472d49,'formatting':_0x1f14ff['formatting']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x46e58f)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0x623a9a=this['editor']['model'],_0x33e145=_0x623a9a['schema'],_0x29f401=_0x623a9a['document']['selection'],_0x41fb56=_0x29b4f4(_0x29f401['getSelectedBlocks']());return!!_0x41fb56&&_0x33e145['checkChild'](_0x41fb56['parent'],'paragraph');}['_prepareForImport'](){const _0x434df0=this['editor'],_0x5431b7=_0x434df0['model'],_0x4b1902=_0x5431b7['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0x434df0['model']['createBatch']({'isUndoable':!0x0}),_0x5431b7['enqueueChange'](this['_undoStepBatch'],_0x5d6c24=>{_0x4b1902['isCollapsed']||_0x5431b7['deleteContent'](_0x4b1902,{'leaveUnmerged':!0x0});const _0x23d48c=_0x4b1902['getFirstPosition'](),_0x11b24a=_0x29b4f4(_0x4b1902['getSelectedBlocks']());let _0x136fe0;_0x136fe0=_0x11b24a['is']('element','paragraph')&&_0x11b24a['isEmpty']?_0x23d48c:_0x23d48c['isAtStart']?_0x5431b7['createPositionBefore'](_0x11b24a):_0x23d48c['isAtEnd']?_0x5431b7['createPositionAfter'](_0x11b24a):_0x5d6c24['split'](_0x23d48c)['position'],this['_importMarker']=_0x5d6c24['addMarker']('importWord:'+_0x37f1dd(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x182694(_0x136fe0)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x191645=this['editor']['model'];_0x191645['markers']['has'](this['_importMarker'])&&_0x191645['enqueueChange'](this['_undoStepBatch'],_0x160311=>{_0x160311['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x1cb3e6,file:_0x5610e6,serviceConfig:_0x3280a3}){const _0x5d1787=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0xacc015=new FormData();_0xacc015['set']('config',JSON['stringify'](_0x3280a3)),_0xacc015['set']('file',_0x5610e6);const _0x447442={'method':'POST','headers':{},'body':_0xacc015,'signal':this['_abortController']['signal']};return _0x5d1787&&(_0x447442['headers']['Authorization']=_0x5d1787['value']),fetch(_0x1cb3e6,_0x447442);}['_handleImportResponse'](_0x5ed77a){return _0x5ed77a['ok']?_0x5ed77a['json']()['then'](_0x3d4b51=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x3d4b51);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x1ddec9('import-word-plugin-import-cancelled');const _0x14a1b0=this['editor'],_0x453ef6=(0x0,_0x14a1b0['t'])('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x14a1b0['plugins']['get']('Notification')['showWarning'](_0x453ef6),_0x19da58('import-word-plugin-conversion-failed');}}