/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x57a2bc,Command as _0x46dd89}from'@ckeditor/ckeditor5-core/dist/index.js';import{FileDialogButtonView as _0x410910,MenuBarMenuListItemFileDialogButtonView as _0x598d57,SpinnerView as _0x4160eb,Notification as _0x223859}from'@ckeditor/ckeditor5-ui/dist/index.js';import{ClipboardPipeline as _0x183c50}from'@ckeditor/ckeditor5-clipboard/dist/index.js';import{Range as _0x8bda20}from'@ckeditor/ckeditor5-engine/dist/index.js';import{first as _0x98b297,uid as _0xc3210d,logWarning as _0x3e4801,logError as _0x55b3d9}from'@ckeditor/ckeditor5-utils/dist/index.js';class o extends _0x57a2bc{static get['pluginName'](){return'ImportWordUI';}['init'](){const _0x39b4f5=this['editor'];_0x39b4f5['ui']['componentFactory']['add']('importWord',()=>{const _0x37155c=this['_createButton'](_0x410910),_0x2ef113=_0x39b4f5['commands']['get']('importWord');return _0x37155c['bind']('isOn')['to'](_0x2ef113,'isBusy'),_0x37155c['tooltip']=!0x0,_0x37155c;}),_0x39b4f5['ui']['componentFactory']['add']('menuBar:importWord',()=>this['_createButton'](_0x598d57));}['_createButton'](_0x37add3){const _0x37d04f=this['editor'],t=_0x37d04f['locale']['t'],_0x58b9b1=_0x37d04f['commands']['get']('importWord'),_0x17709f=new _0x37add3(_0x37d04f['locale']),_0x3c4851=new _0x4160eb();return _0x17709f['set']({'acceptedType':'application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.wordprocessingml.template'}),_0x17709f['set']({'icon':'<svg\x20viewBox=\x220\x200\x2020\x2020\x22\x20xmlns=\x22http://www.w3.org/2000/svg\x22><path\x20d=\x22m14\x200\x205\x204.5v8.892l-1.5-1.8V6.5h-5v-5h-8v3H3V0h11Zm0\x202v3h3.3L14\x202Z\x22/><path\x20d=\x22M10.74\x2018a2.76\x202.76\x200\x200\x201-.469-.5H3V19h9.25v-.374A2.737\x202.737\x200\x200\x201\x2010.74\x2018Z\x22/><path\x20d=\x22M8.5\x206a1.5\x201.5\x200\x200\x201\x201.493\x201.356L10\x207.5v7a1.5\x201.5\x200\x200\x201-1.356\x201.493L8.5\x2016h-7a1.5\x201.5\x200\x200\x201-1.493-1.356L0\x2014.5v-7a1.5\x201.5\x200\x200\x201\x201.356-1.493L1.5\x206h7ZM7.483\x208.795l-.042.088-.986\x202.534-.947-2.528-.043-.092a.601.601\x200\x200\x200-1.042.008l-.042.093-.883\x202.465-.937-2.475-.042-.089a.6.6\x200\x200\x200-1.107.42l.027.093\x201.514\x204\x20.044.092a.6.6\x200\x200\x200\x201.041-.01l.041-.092.88-2.458.925\x202.467.046.096a.602.602\x200\x200\x200\x201.032\x200l.043-.09\x201.554-4\x20.028-.093a.6.6\x200\x200\x200-1.104-.43v.001ZM11.674\x2015.407a.75.75\x200\x201\x200\x201.152.96L14\x2014.96V20h1.5v-5.04l1.174\x201.408a.75.75\x200\x201\x200\x201.152-.96l-2.346-2.816a.95.95\x200\x200\x200-1.46\x200l-2.346\x202.815Z\x22/></svg>\x0a'}),_0x17709f['bind']('isEnabled')['to'](_0x58b9b1),_0x17709f['bind']('label')['to'](_0x58b9b1,'isBusy',_0x3dd0de=>t(_0x3dd0de?'Importing\x20Word\x20document':'Import\x20from\x20Word')),_0x3c4851['bind']('isVisible')['to'](_0x58b9b1,'isBusy'),_0x17709f['iconView']['bind']('isVisible')['to'](_0x58b9b1,'isBusy',_0x28e669=>!_0x28e669),_0x17709f['children']['add'](_0x3c4851),_0x17709f['on']('done',(_0x22f5d6,_0x1a75a3)=>{_0x37d04f['execute']('importWord',_0x1a75a3[0x0],{}),_0x37d04f['editing']['view']['focus']();}),_0x17709f;}}class d extends _0x46dd89{['_importMarker'];['_undoStepBatch'];['_abortController'];constructor(_0x3ce86f){super(_0x3ce86f),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x526edf,_0x5f2889)=>{const _0x54da83=new DataTransfer();_0x54da83['setData']('text/html',_0x5f2889['html']);const _0x439be3=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x59b931=>{this['_importMarker']['stopListening'](),_0x59b931['setSelection'](_0x439be3),_0x3ce86f['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x54da83});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x5dd635,_0x438271={}){if(this['isBusy'])return Promise['resolve']();const _0x369b7f=this['editor']['config']['get']('importWord'),_0x24c8a5={'url':_0x369b7f['converterUrl'],'file':_0x5dd635,'serviceConfig':{..._0x438271,'formatting':_0x369b7f['formatting']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x24c8a5)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0x104fe7=this['editor']['model'],_0x346954=_0x104fe7['schema'],_0x38eda5=_0x104fe7['document']['selection'],_0x2fe7e0=_0x98b297(_0x38eda5['getSelectedBlocks']());return!!_0x2fe7e0&&_0x346954['checkChild'](_0x2fe7e0['parent'],'paragraph');}['_prepareForImport'](){const _0xc81c43=this['editor'],_0x1ca102=_0xc81c43['model'],_0x3e6a1e=_0x1ca102['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0xc81c43['model']['createBatch']({'isUndoable':!0x0}),_0x1ca102['enqueueChange'](this['_undoStepBatch'],_0x22762a=>{_0x3e6a1e['isCollapsed']||_0x1ca102['deleteContent'](_0x3e6a1e,{'leaveUnmerged':!0x0});const _0x39bfd5=_0x3e6a1e['getFirstPosition'](),_0x1067aa=_0x98b297(_0x3e6a1e['getSelectedBlocks']());let _0x52e071;_0x52e071=_0x1067aa['is']('element','paragraph')&&_0x1067aa['isEmpty']?_0x39bfd5:_0x39bfd5['isAtStart']?_0x1ca102['createPositionBefore'](_0x1067aa):_0x39bfd5['isAtEnd']?_0x1ca102['createPositionAfter'](_0x1067aa):_0x22762a['split'](_0x39bfd5)['position'],this['_importMarker']=_0x22762a['addMarker']('importWord:'+_0xc3210d(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x8bda20(_0x52e071)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x1193ae=this['editor']['model'];_0x1193ae['markers']['has'](this['_importMarker'])&&_0x1193ae['enqueueChange'](this['_undoStepBatch'],_0x29dcd2=>{_0x29dcd2['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x295686,file:_0x65b8a7,serviceConfig:_0x35b24e}){const _0xcd30d0=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x1ac44c=new FormData();_0x1ac44c['set']('config',JSON['stringify'](_0x35b24e)),_0x1ac44c['set']('file',_0x65b8a7);const _0x10891c={'method':'POST','headers':{},'body':_0x1ac44c,'signal':this['_abortController']['signal']};return _0xcd30d0&&(_0x10891c['headers']['Authorization']=_0xcd30d0['value']),fetch(_0x295686,_0x10891c);}['_handleImportResponse'](_0xa41e8a){return _0xa41e8a['ok']?_0xa41e8a['json']()['then'](_0x4f48af=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x4f48af);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0x3e4801('import-word-plugin-import-cancelled');const _0x3ec266=this['editor'],_0x468155=(0x0,_0x3ec266['t'])('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x3ec266['plugins']['get']('Notification')['showWarning'](_0x468155),_0x55b3d9('import-word-plugin-conversion-failed');}}class e extends _0x57a2bc{['_token'];static get['pluginName'](){return'ImportWordEditing';}static get['requires'](){return[_0x223859,_0x183c50,'CloudServices'];}constructor(_0x2d67e2){super(_0x2d67e2),this['_token']=null;}async['init'](){const _0xf293b=this['editor'];_0xf293b['config']['define']('importWord',{'converterUrl':'https://docx-converter.cke-cs.com/v2/convert/docx-html','tokenUrl':(_0xf293b['config']['get']('cloudServices')||{})['tokenUrl'],'formatting':{'resets':'none','defaults':'none','styles':'inline'}}),_0xf293b['commands']['add']('importWord',new d(_0xf293b));const {tokenUrl:_0x4bb677}=_0xf293b['config']['get']('importWord');if(_0x4bb677){const {tokenUrl:_0x3f3768}=_0xf293b['config']['get']('cloudServices')||{};this['_token']=_0x4bb677===_0x3f3768?_0xf293b['plugins']['get']('CloudServices')['token']:await _0xf293b['plugins']['get']('CloudServices')['registerTokenUrl'](_0x4bb677);}}['getToken'](){return this['_token'];}}class i extends _0x57a2bc{static get['pluginName'](){return'ImportWord';}static get['requires'](){return[e,o];}}export{i as ImportWord,e as ImportWordEditing,o as ImportWordUI};