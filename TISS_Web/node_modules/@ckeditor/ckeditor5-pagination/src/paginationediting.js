/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x546672}from'ckeditor5/src/core.js';import{CKEditorError as _0x21e136}from'ckeditor5/src/utils.js';import _0x32cba9 from'./paginationlookup.js';import _0x18930f from'./paginationrenderer.js';import'../theme/pagination.css';export default class s extends _0x546672{static get['pluginName'](){return'PaginationEditing';}static get['requires'](){return[_0x32cba9,_0x18930f];}['init'](){this['set']({'pageNumber':0x1,'totalPages':0x1});const _0x46b003=this['editor']['plugins']['get']('Pagination'),_0x302b7d=this['editor']['plugins']['get'](_0x32cba9),_0x23f1b7=this['editor']['plugins']['get'](_0x18930f);this['bind']('isEnabled')['to'](_0x46b003),this['_setUpDataDowncastConversion'](),this['bind']('pageNumber')['to'](_0x23f1b7),this['listenTo'](_0x302b7d,'change:pageBreaks',(_0x1fa0a5,_0x10bd48,_0x32d5a8,_0x4467c0)=>{this['totalPages']=_0x32d5a8['length'],this['_updatePageBreakMarkers'](_0x32d5a8,_0x4467c0);}),this['_setupKeystrokes']();const _0x152757=this['editor'];this['licenseKey']=_0x152757['config']['get']('licenseKey'),this['_licenseKeyCheckInterval']=setInterval(()=>{let _0x47a6ee;for(const _0x22a2cf in _0x152757){const _0xfcb41d=_0x22a2cf,_0x576b75=_0x152757[_0xfcb41d];if('paginationLicenseKeyTrial'===_0x576b75||'paginationLicenseKeyInvalid'===_0x576b75||'paginationLicenseKeyValid'===_0x576b75||'paginationLicenseKeyTrialLimit:operations'===_0x576b75){delete _0x152757[_0xfcb41d],_0x47a6ee=_0x576b75;break;}}if('paginationLicenseKeyInvalid'===_0x47a6ee)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x21e136('pagination-invalid-license-key',null);if('paginationLicenseKeyTrial'===_0x47a6ee&&console['info']('You\x20are\x20using\x20the\x20trial\x20version\x20of\x20CKEditor\x205\x20pagination\x20plugin\x20with\x20limited\x20usage.\x20Make\x20sure\x20you\x20will\x20not\x20use\x20it\x20in\x20the\x20production\x20environment.'),'paginationLicenseKeyTrialLimit:operations'===_0x47a6ee)throw clearInterval(this['_licenseKeyCheckInterval']),new _0x21e136('pagination-trial-license-key-reached-limit-changes',null);'paginationLicenseKeyValid'===_0x47a6ee&&clearInterval(this['_licenseKeyCheckInterval']);},0x3e8);}['destroy'](){clearInterval(this['_licenseKeyCheckInterval']);}['scrollToPage'](_0x53480f){if(!this['isEnabled'])return;this['editor']['plugins']['get'](_0x18930f)['scrollToPage'](this['_validatePageNumber'](_0x53480f));}['moveSelectionToPage'](_0x330894){if(!this['isEnabled'])return;const _0x58dceb=this['editor'],_0x4cd422=this['editor']['plugins']['get'](_0x32cba9)['pageBreaks'][_0x330894-0x1];_0x4cd422&&_0x58dceb['model']['change'](_0x21fd71=>{switch(_0x4cd422['type']){case'manual':{const _0xa8d990=_0x58dceb['model']['schema']['getNearestSelectionRange'](_0x4cd422['modelRange']['end'],'forward');_0x21fd71['setSelection'](_0xa8d990);break;}case'element':{const _0x13cfa9=_0x58dceb['model']['schema']['getNearestSelectionRange'](_0x4cd422['modelRange']['start'],'forward');_0x21fd71['setSelection'](_0x13cfa9);break;}case'text':{const _0x3a27e1=_0x4cd422['modelRange']['start'];if('\x20'===_0x3a27e1['textNode']['data'][_0x3a27e1['offset']]){const _0x421d0c=_0x21fd71['createPositionAt'](_0x3a27e1['parent'],_0x3a27e1['offset']+0x1);_0x21fd71['setSelection'](_0x421d0c);}else _0x21fd71['setSelection'](_0x4cd422['modelRange']);}}_0x58dceb['editing']['view']['focus']();});}['goToNextPage'](){const _0x4216ea=this['_validatePageNumber'](this['pageNumber']+0x1);this['moveSelectionToPage'](_0x4216ea),this['scrollToPage'](_0x4216ea);}['goToPreviousPage'](){const _0x327f71=this['_validatePageNumber'](this['pageNumber']-0x1);this['moveSelectionToPage'](_0x327f71),this['scrollToPage'](_0x327f71);}['_updatePageBreakMarkers'](_0xdbc415,_0xb3a503){const _0x2927a0=this['editor']['model'];this['isEnabled']&&_0x2927a0['change'](_0x1129f4=>{for(let _0x4b7ef4=0x1;_0x4b7ef4<_0xdbc415['length'];_0x4b7ef4++){const _0x3da728=_0xdbc415[_0x4b7ef4]['modelRange'],_0x1af600='pagination:'+(_0x4b7ef4+0x1);_0x2927a0['markers']['has'](_0x1af600)?_0x1129f4['updateMarker'](_0x1af600,{'range':_0x3da728}):_0x1129f4['addMarker'](_0x1af600,{'range':_0x3da728,'usingOperation':!0x1,'affectsData':!0x0});}for(let _0x2c7cdd=_0xdbc415['length'];_0x2c7cdd<_0xb3a503['length'];_0x2c7cdd++){const _0x6eacd9='pagination:'+(_0x2c7cdd+0x1);_0x2927a0['markers']['has'](_0x6eacd9)&&_0x1129f4['removeMarker'](_0x6eacd9);}});}['_setUpDataDowncastConversion'](){const _0xe0f580='pagination';this['editor']['conversion']['for']('dataDowncast')['add'](_0x3747b3=>{_0x3747b3['on']('addMarker:'+_0xe0f580,(_0x37a9e5,{markerRange:_0x208b6b,markerName:_0x2d997f},_0x3c8bee)=>{if(!_0x3c8bee['options']['pagination'])return;if(!_0x3c8bee['consumable']['consume'](_0x208b6b,_0x37a9e5['name']))return;const _0x1b03c0=_0x208b6b['getContainedElement']();let _0x366379=_0x1b03c0?_0x3c8bee['mapper']['toViewElement'](_0x1b03c0):null;if(!_0x366379){const _0x1c1d56=_0x208b6b['start'];if(_0x3c8bee['schema']['checkChild'](_0x1c1d56,'$text')){const _0x2954ba=_0x3c8bee['mapper']['toViewPosition'](_0x1c1d56);_0x366379=_0x3c8bee['writer']['createContainerElement']('span'),_0x366379['getFillerOffset']=()=>null,_0x3c8bee['writer']['insert'](_0x2954ba,_0x366379);}else{const _0x6cf939=_0x1c1d56['nodeAfter'];_0x366379=_0x3c8bee['mapper']['toViewElement'](_0x6cf939);}}for(;_0x366379['parent']!==_0x366379['root']&&0x0===_0x366379['index'];)_0x366379=_0x366379['parent'];const _0x28e040=_0x2d997f['substring'](0xb);_0x3c8bee['writer']['setStyle']('page-break-before','always',_0x366379),_0x3c8bee['writer']['setAttribute']('data-pagination-page',_0x28e040,_0x366379),_0x3c8bee['mapper']['bindElementToMarker'](_0x366379,_0x2d997f),_0x37a9e5['stop']();});});}['_setupKeystrokes'](){const _0x7e2467=this['editor'],t=_0x7e2467['locale']['t'];_0x7e2467['keystrokes']['set']('Shift+Pageup',(_0xc2e417,_0x2dfcbc)=>{this['goToPreviousPage'](),_0x2dfcbc();}),_0x7e2467['keystrokes']['set']('Shift+Pagedown',(_0x1f79de,_0x302751)=>{this['goToNextPage'](),_0x302751();}),_0x7e2467['accessibility']['addKeystrokeInfoGroup']({'id':'pagination','label':t('Keystrokes\x20for\x20navigating\x20through\x20documents'),'keystrokes':[{'label':t('Go\x20to\x20the\x20previous\x20page\x20(also\x20move\x20selection)'),'keystroke':'Shift+Pageup','mayRequireFn':!0x0},{'label':t('Go\x20to\x20the\x20next\x20page\x20(also\x20move\x20selection)'),'keystroke':'Shift+Pagedown','mayRequireFn':!0x0}]});}['_validatePageNumber'](_0x49b4d6){return _0x49b4d6<0x1&&(_0x49b4d6=0x1),_0x49b4d6>this['totalPages']&&(_0x49b4d6=this['totalPages']),_0x49b4d6;}}