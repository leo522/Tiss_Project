/*
 *             Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x4696fb,icons as _0x45420b}from'ckeditor5/src/core.js';import{createDropdown as _0x59180d,ButtonView as _0x4b84ab,ListItemView as _0x19b3d5,ListView as te,MenuBarMenuListItemButtonView as _0x41ac3e,MenuBarMenuListItemView as _0x151a11,MenuBarMenuListView as _0x3987bc,MenuBarMenuView as _0x527680}from'ckeditor5/src/ui.js';import _0xe7f8f9 from'../../revisiontracker.js';import _0x1472f3 from'./revisionhistorysaverevisionformview.js';import{getTranslation as _0x3c3038}from'../../utils/common-translations.js';export default class u extends _0x4696fb{static get['pluginName'](){return'RevisionHistoryUI';}static get['requires'](){return[_0xe7f8f9];}['init'](){const _0x1058e0=this['editor'],_0x3d451a=_0x1058e0['plugins']['get']('RevisionTracker');_0x1058e0['ui']['componentFactory']['add']('revisionHistory',_0xd02352=>{const _0xaedab=_0x59180d(_0xd02352),_0x59e725=_0xaedab['panelView']['children'],_0x4dc2f2=new te(_0xd02352),_0x2a6d79=new _0x19b3d5(_0xd02352),_0xcf98c9=new _0x4b84ab(_0xd02352),_0x41a1e5=new _0x19b3d5(_0xd02352),_0x335af1=new _0x4b84ab(_0xd02352);return _0xaedab['bind']('isEnabled')['to'](_0x3d451a,'isReady',_0x3d451a,'isEnabled',_0x1058e0,'isReadOnly',(_0x2331cd,_0x2fc394,_0x26876e)=>_0x2331cd&&_0x2fc394&&!_0x26876e),_0xaedab['buttonView']['set']({'icon':_0x45420b['history'],'label':_0x3c3038(_0xd02352,'Revision\x20history'),'tooltip':!0x0}),_0xcf98c9['set']({'label':_0x3c3038(_0xd02352,'Save\x20current\x20revision'),'withText':!0x0,'role':'menuitem'}),_0xcf98c9['bind']('isEnabled')['to'](_0x3d451a,'isReady',_0x3d451a,'isEnabled',_0x1058e0,'isReadOnly',(_0x327a5b,_0x5201b0,_0x49fe18)=>_0x327a5b&&_0x5201b0&&!_0x49fe18),_0xcf98c9['on']('execute',()=>this['_showDialog']()),_0x335af1['set']({'label':_0x3c3038(_0xd02352,'Open\x20revision\x20history'),'withText':!0x0,'role':'menuitem'}),_0x335af1['bind']('isEnabled')['to'](_0x3d451a,'isReady',_0x1058e0,'isReadOnly',(_0x3f06c8,_0x1b318c)=>_0x3f06c8&&!_0x1b318c),_0x335af1['on']('execute',()=>{_0x1058e0['config']['get']('revisionHistory')['showRevisionViewerCallback'](),_0xaedab['isOpen']=!0x1,_0x1058e0['editing']['view']['focus']();}),_0x2a6d79['children']['add'](_0xcf98c9),_0x41a1e5['children']['add'](_0x335af1),_0x4dc2f2['role']='menu',_0x4dc2f2['items']['addMany']([_0x2a6d79,_0x41a1e5]),_0x59e725['add'](_0x4dc2f2),_0xaedab;}),_0x1058e0['ui']['componentFactory']['add']('menuBar:revisionHistory',()=>this['_registerMenuComponent']());}['_registerMenuComponent'](){const _0x2b9fcb=this['editor'],_0x5f3c95=_0x2b9fcb['locale'],_0x5bbbd6=new _0x527680(_0x5f3c95),_0x1d4be3=new _0x3987bc(_0x5f3c95);_0x5bbbd6['buttonView']['set']({'icon':_0x45420b['history'],'label':_0x3c3038(_0x5f3c95,'Revision\x20history')});const _0x37260b=new _0x151a11(_0x5f3c95,_0x5bbbd6),_0x323460=new _0x41ac3e(_0x5f3c95);_0x323460['set']({'label':_0x3c3038(_0x5f3c95,'Save\x20current\x20revision')}),_0x323460['delegate']('execute')['to'](_0x5bbbd6),_0x323460['on']('execute',()=>{this['_showDialog']();}),_0x37260b['children']['add'](_0x323460),_0x1d4be3['items']['add'](_0x37260b);const _0xa1a389=new _0x151a11(_0x5f3c95,_0x5bbbd6),_0x4a8d98=new _0x41ac3e(_0x5f3c95);return _0x4a8d98['set']({'label':_0x3c3038(_0x5f3c95,'Open\x20revision\x20history')}),_0x4a8d98['delegate']('execute')['to'](_0x5bbbd6),_0x4a8d98['on']('execute',()=>{_0x2b9fcb['config']['get']('revisionHistory')['showRevisionViewerCallback']();}),_0xa1a389['children']['add'](_0x4a8d98),_0x1d4be3['items']['add'](_0xa1a389),_0x5bbbd6['panelView']['children']['add'](_0x1d4be3),_0x5bbbd6;}['_showDialog'](){const _0x78ab2a=this['editor'],_0x43fef8=_0x78ab2a['locale'],t=_0x43fef8['t'],_0x29a118=_0x78ab2a['plugins']['get']('Dialog'),_0x23c016=_0x78ab2a['plugins']['get']('RevisionTracker');function _0x5306f9(_0x502da6){_0x78ab2a['config']['get']('revisionHistory.requireRevisionName')&&''===_0x502da6['revisionName']?_0x502da6['revisionNameInputView']['errorText']=_0x3c3038(_0x43fef8,'The\x20revision\x20name\x20cannot\x20be\x20empty.'):(_0x78ab2a['plugins']['get'](_0xe7f8f9)['saveRevision']({'name':_0x502da6['revisionName']}),_0x29a118['hide']());}this['_saveRevisionFormView']||(this['_createSaveRevisionFormView'](),this['_saveRevisionFormView']['on']('submit',()=>_0x5306f9(this['_saveRevisionFormView']))),this['_saveRevisionFormView']['reset'](),_0x29a118['show']({'id':'revisionSave','title':_0x3c3038(_0x43fef8,'Save\x20current\x20revision'),'isModal':!0x0,'content':this['_saveRevisionFormView'],'actionButtons':[{'label':t('Cancel'),'withText':!0x0,'onExecute':()=>_0x29a118['hide']()},{'label':t('Accept'),'class':'ck-button-action','withText':!0x0,'onCreate'(_0x652915){_0x652915['bind']('isEnabled')['to'](_0x23c016,'isReady',_0x23c016,'isEnabled',_0x78ab2a,'isReadOnly',(_0x2a68ec,_0x4f9db8,_0x1b6519)=>_0x2a68ec&&_0x4f9db8&&!_0x1b6519);},'onExecute':()=>_0x5306f9(this['_saveRevisionFormView'])}]});}['_createSaveRevisionFormView'](){const _0x57f4ad=this['editor'],_0x4b8c4d=_0x57f4ad['locale'];this['_saveRevisionFormView']=new _0x1472f3(_0x4b8c4d,_0x57f4ad['config']['get']('revisionHistory.requireRevisionName')),this['_saveRevisionFormView']['render']();}}